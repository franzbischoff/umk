function prepareScope(){chart&&chart.dispose(),chart=am4core.create("scope",am4charts.XYChart);const e=chart.xAxes.push(new am4charts.ValueAxis),t=chart.yAxes.push(new am4charts.ValueAxis);e.padding(0,0,0,0),t.padding(0,0,0,0),e.logarithmic=!!settings.xLogScale,t.logarithmic=!!settings.yLogScale,chart.padding(0,32,10,0),chart.legend=new am4charts.Legend,chart.legend.position="top",chart.legend.itemContainers.template.paddingTop=0,chart.legend.itemContainers.template.paddingBottom=0,chart.legend.fontSize=10,chart.legend.useDefaultMarker=!0;var a=chart.legend.markers.template.children.getIndex(0);a.cornerRadius(12,12,12,12),a.strokeWidth=2,chart.cursor=new am4charts.XYCursor,chart.numberFormatter.numberFormat="##.###e",chart.cursor.behavior="zoomXY",prepareColors()}function updateData(e){chart||prepareScope();const t=[];let a=!0;for(let r=0;r<e.length;r++){const o={};for(let t=0;t<e[r].v[0].r.length;t++)for(let s=0;s<e[r].v[0].r[0].length;s++){const c="r_"+(t+1)+"_"+(s+1),n="i_"+(t+1)+"_"+(s+1);settings.xLogScale?(o["x_"+c]=e[r].v[0].r[t][s]>0?e[r].v[0].r[t][s]:NaN,o["x_"+n]=e[r].v[0].i[t][s]>0?e[r].v[0].i[t][s]:NaN):(o["x_"+c]=e[r].v[0].r[t][s],o["x_"+n]=e[r].v[0].i[t][s]);try{settings.yLogScale?(o["y_"+c]=e[r].v[1].r[t][s]>0?e[r].v[1].r[t][s]:NaN,o["y_"+n]=e[r].v[1].i[t][s]>0?e[r].v[1].i[t][s]:NaN):(o["y_"+c]=e[r].v[1].r[t][s],o["y_"+n]=e[r].v[1].i[t][s])}catch(e){o["y_"+c]=NaN,o["y_"+n]=NaN}if(0===chart.data.length&&a){createANewSeries(c,"("+(t+1)+", "+(s+1)+")");const e=createANewSeries(n,"Img("+(t+1)+","+(s+1)+")");settings.showImg||(e.hidden=!0)}}t.push(o),a=!1}let r=chart.data.length+t.length-settings.limitData;r<0&&(r=0),chart.addData(t,r)}function adjustImagSeriesView(){if(chart){const e=chart.series.length/2;for(let t=0;t<e;t++)settings.showImg?chart.series.getIndex(2*t+1).show():chart.series.getIndex(2*t+1).hide()}}function prepareColors(){if(document.getElementsByTagName("html")[0].className=settings.mSettings.theme,chart){for(let e=0;e<chart.xAxes.length;e++)setAxisColorProperties(chart.xAxes.getIndex(e));for(let e=0;e<chart.yAxes.length;e++)setAxisColorProperties(chart.yAxes.getIndex(e));chart.zoomOutButton.background.cornerRadius(5,5,5,5),chart.zoomOutButton.background.fill=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-1"),null).getPropertyValue("border-color")),chart.zoomOutButton.icon.stroke=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-1"),null).getPropertyValue("color")),chart.zoomOutButton.icon.strokeWidth=2,chart.zoomOutButton.background.states.getKey("hover").properties.fill=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-3"),null).getPropertyValue("background-color"))}}function setAxisColorProperties(e){e.setStroke(am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-0"),null).getPropertyValue("color"))),e.strokeWidth=0,e.setFill(am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-0"),null).getPropertyValue("color"))),e.renderer.grid.template.stroke=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-0"),null).getPropertyValue("border-color")),e.renderer.grid.template.strokeWidth=1,e.renderer.grid.template.strokeOpacity=.5}function createANewSeries(e,t){const a=chart.series.push(new am4charts.LineSeries);return a.dataFields.valueX="x_"+e,a.dataFields.valueY="y_"+e,a.strokeWidth=2,a.name=t,a.tooltipText="{t}",a}let chart;const settings={isChartReady:!1,showImg:!1,limitData:1e3,mSettings:{},xLogScale:!1,yLogScale:!1};let inData;onmessage=function(e){if(e.data.d&&settings.isChartReady&&updateData(e.data.d),e.data.r&&settings.isChartReady&&prepareScope(),e.data.c){let t=!1;settings.xLogScale!==e.data.c.Parameters.xLogScale.Value[0][0]&&(settings.xLogScale=e.data.c.Parameters.xLogScale.Value[0][0],t=!0),settings.yLogScale!==e.data.c.Parameters.yLogScale.Value[0][0]&&(settings.yLogScale=e.data.c.Parameters.yLogScale.Value[0][0],t=!0),settings.showImg!==e.data.c.Parameters.showIm.Value[0][0]&&(settings.showImg=e.data.c.Parameters.showIm.Value[0][0],adjustImagSeriesView()),settings.limitData=JSON.parse(e.data.c.Parameters.limitData.Value)[0][0],document.title=e.data.c.Name,t&&prepareScope()}e.data.s&&(settings.mSettings=e.data.s,prepareColors())},am4core.ready(function(){settings.isChartReady=!0,am4core.useTheme(am4themes_animated),am4core.useTheme(am4themes_kelly)});