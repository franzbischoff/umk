<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>UYAMAK: Add blocks</title>
	<link rel="manifest" href="manifest.json">
	<script src="https://www.gstatic.com/firebasejs/5.5/firebase.js"></script>
	<script src="js/config.js"></script>
	<script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
	<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-w3schools.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
</head>
<body>
<div id="app">
<div v-if="waitForAProcess.show" class="w3-modal w3-display-container" style="display: block;">
	<div class="w3-display-middle w3-center w3-padding" style="background-color: rgba(255, 255, 255, 0.5);">
			<p v-html="waitForAProcess.title" class="w3-large">Connecting to server</p>
			<div class="fa-3x">
					<i class="fas fa-spinner fa-pulse"></i>
			</div>
			<p v-html="waitForAProcess.text" class="w3-large">Please wait while loading the app. If this process takes longer than a minute, check your internet connection and refresh the page.</p>
	</div>
</div>
<div class="w3-sidebar w3-card" style="width:25%;">
		<label>Choose a category</label>
		<select class="w3-select w3-border w3-border-theme" style="cursor: pointer;" v-model="selectedCategory">
			<option value="" disabled selected>Choose a category</option>
			<option v-for="(option, index) in functionsCategories" v-bind:value="index">{{option.text}}</option>
		</select>
		<div class="w3-small">{{functionsCategories[selectedCategory].description}}</div>
		<div class="w3-btn w3-ripple w3-block">Add a new function</div>
		<input class="w3-input w3-border w3-border-theme" v-model="filterForFunctions" type="text" placeholder="Search ...">
		<ul class="w3-ul w3-card">
			<li class="w3-bar" v-for="(block, index) in filteredBlocks" style="cursor: pointer;">
				<img v-bind:src="svgTextToURL(functionsCategories[selectedCategory].preIcon+block.icon+functionsCategories[selectedCategory].postIcon)" class="w3-bar-item" style="height: 42.4px; padding: 0">
				<div class="w3-bar-item" v-bind:title="block.description">
					<span class="w3-large">{{block.name}}</span>
				</div>
			</li>
		</ul>
</div>
<div class="w3-sidebar w3-bar-block w3-card" style="width:50%; right:0">
		<label>Choose a category</label>
		<select class="w3-select w3-border w3-border-theme" style="cursor: pointer;" name="option" v-model="selectedCategory">
			<option value="" disabled selected>Choose a category</option>
			<option v-for="(option, index) in functionsCategories" v-bind:value="index">{{option.text}}</option>
		</select>
		<div class="w3-small">{{functionsCategories[selectedCategory].description}}</div>
</div>
<div class="w3-sidebar w3-bar-block w3-card" style="width: calc(25% - 10px); left: calc(25% + 5px)">
		<label>Choose a category</label>
		<select class="w3-select w3-border w3-border-theme" style="cursor: pointer;" name="option" v-model="selectedCategory">
			<option value="" disabled selected>Choose a category</option>
			<option v-for="(option, index) in functionsCategories" v-bind:value="index">{{option.text}}</option>
		</select>
		<div class="w3-small">{{functionsCategories[selectedCategory].description}}</div>
</div>


</div>
<script>
//Common.js

Object.filter = (obj, predicate) => 
    Object.keys(obj)
          .filter( key => predicate(obj[key]) )
          .reduce( (res, key) => (res[key] = obj[key], res), {} );


</script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
var app = new Vue({
	"el": '#app',
	"data": {
		"waitForAProcess": {"show": 1, "title": "Loading database", "text": "Please wait while loading the app. If this process takes longer than a minute, check your internet connection and refresh the page."},
		"filterForFunctions": "",
		"selectedCategory": "sources",
		"toolConsts":{"toolDiameter": 36, "canvas": {"x": 0, "y": 0},  "DOM": {"x": 0, "y": 0}},
		"networkConst": {"scale": 0, "xView": 0, "yView": 1, "halfWidth": 0, "halfHeight": 0},
		"sources":{},"sinks":{},"basics":{},"logics":{},"continuous":{},"discrete":{},"hardware":{},"functionsCategories":{"sources":{"text":"Sources","description":"Sources generate the signals to feed to the model.","order":"0","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#04FB6B' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#36FC89' stroke-width='10'>","postIcon":"</g></svg>"},"sinks":{"text":"Sinks","description":"Sinks output the information. They can be graphs or file download","order":"1","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#0000FF' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#00FF7F' stroke-width='10'>","postIcon":"</g></svg>"},"basics":{"text":"Basic operations","description":"Basic mathematical operations are given","order":"2","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#00FF80' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#00FF7F' stroke-width='10'>","postIcon":"</g></svg>"},"logics":{"text":"Logical operations","description":"Logical operations are available in this section","order":"3","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#FFFF00' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#00FF7F' stroke-width='10'>","postIcon":"</g></svg>"},"continuous":{"text":"Continuous time","description":"Dynamic operations are available here for continuous time operations","order":"4","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#FF0000' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#00FF7F' stroke-width='10'>","postIcon":"</g></svg>"},"discrete":{"text":"Discrete time","description":"Dynamic operations are available here for discrete time operations","order":"5","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#80FF00' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#00FF7F' stroke-width='10'>","postIcon":"</g></svg>"},"hardware":{"text":"Hardware tools","description":"Hardware i/o blocks are available here","order":"6","preIcon":"<svg viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='3'/><feOffset dx='2' dy='2' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='5' dy='5' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='5' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='5' height='100' width='100' y='10' x='10' stroke-width='0' fill='#00FFFF' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='#00FF7F' stroke-width='10'>","postIcon":"</g></svg>"}}
	},
	"computed": {
		"filteredBlocks": function () {
				if (typeof(this[this.selectedCategory]) === "object")
			return Object.filter(this[this.selectedCategory], item => (item.name.toLowerCase().search(this.filterForFunctions.toLowerCase())>=0 || item.description.toLowerCase().search(this.filterForFunctions.toLowerCase())>=0));
		}
	},
	"methods": {
		"svgTextToURL": function (svg) {
			let tempBlob = new Blob([svg], {type: 'image/svg+xml'});
			let url = URL.createObjectURL(tempBlob);
			return url;
		}
	}
})
</script>

<script>
</script>
<script>
const functions = firebase.functions();
const db = firebase.firestore();
const settings = {timestampsInSnapshots: true};
db.settings(settings);
var validateUserSession = firebase.functions().httpsCallable('validateUserSession');
var TempRecAttempt;
firebase.auth().onAuthStateChanged(function (user) {
	TempRecAttempt = setInterval(function () {
		console.log("attempt");
		if (app) {
			app.$data.waitForAProcess.title = "Verifying the license.";
			clearInterval(TempRecAttempt);
			user ? handleSignedInUser(user) : handleSignedOutUser();
		}
	}, 500);
});
async function handleSignedInUser(user) {
	if (user.uid === "4DYtf7b8cBVgvDJ1Taiz3cPK9qI2"){
		app.$data.waitForAProcess.title = "Loading function blocks summary.";
		for (var blockID in app.$data.functionsCategories) {
			//console.log(blockID);
			await db.collection("blocks-summary").doc(blockID).onSnapshot(async function(doc) {
				app.$data.waitForAProcess.show++;
				if (doc.exists) app.$data[doc.id] = doc.data();
				app.$data.waitForAProcess.show--;
			});
		}
		app.$data.waitForAProcess.show--;
		loadTheGUI();
	} else window.location.replace("/platform/admin");		
}
function handleSignedOutUser() {
	window.location.replace("/sign-in?redirect=" + location.pathname);
}
function loadTheGUI() {
	
}
</script>
</body>
</html>
