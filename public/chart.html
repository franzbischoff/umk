<!DOCTYPE html>
<html>

<head>
  <!--Load the AJAX API-->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.0.3/math.min.js"
    integrity="sha256-TNeqgLgUT/0XFsg+YaC13WI8OyU2S9E5/5P79536W6A=" crossorigin="anonymous"></script>
  <script type="text/javascript">
    google.charts.load('current', {
      'packages': ['corechart']
    });

    google.charts.setOnLoadCallback(initialize);

    var data, options, chart, inParams;
    var TempSeries = [];

    function prepareOptions() {
      options = {
        legend: "in",
        chartArea: {
          right: 25,
          top: 25,
          left: 100,
          bottom: 50,
        },
        vAxis: {
          scaleType: inParams.vAxis.Value[0][0]
        },
        hAxis: {
          scaleType: inParams.hAxis.Value[0][0],
          title: 'Time (t)'
        },
        explorer: {
          actions: ['dragToZoom', 'rightClickToReset'],
        },
        backgroundColor: {
          fill: 'transparent'
        },
        series: TempSeries,
      };
    }

    function prepareData() {
      TempSeries = [];
      data = new google.visualization.DataTable();
      data.addColumn('number', 'Time');
      for (var i = 0; i < inParams.lTitles.Value.length; i++) {
        data.addColumn('number', inParams.lTitles.Value[i]);
        var TempLineStyle = {
          lineDashStyle: [0],
          color: inParams.lColors.Value[i][0],
        };
        TempSeries.push(TempLineStyle);
        if (inParams.numHandling.Value[0][0] === "both") {
          data.addColumn('number', "Re:" + inParams.lTitles.Value[i][0]);
          TempLineStyle = {
            lineDashStyle: [4, 4],
            color: inParams.lColors.Value[i][0],
            visibleInLegend: false
          };
          console.log(TempLineStyle);
          TempSeries.push(TempLineStyle);
        }
      }
    }

    function generateChart() {
      chart = new google.visualization.LineChart(document.getElementById('chart_div'));
    }

    function initialize() {
      generateChart();
      resetPlotView();
    }

    function addRow(rowData) {
      var t = rowData.t;
      var val = rowData.val;
      var tempRowToSend = [t];
      var expectedLength
      if (inParams.numHandling.Value[0][0] === "both") expectedLength = inParams.lTitles.Value.length*2 +1;
      else expectedLength = inParams.lTitles.Value.length + 1;
      try {
        for (var i = 0; i < val.length; i++) {
          for (var j = 0; j < val.length; j++) {
            try {
              console.log(math.complex(val[i][j]));
              switch (inParams.numHandling.Value[0][0]) {
                case "both":
                  times = 2;
                  tempRowToSend.push(math.complex(val[i][j]).re)
                case "img":
                  tempRowToSend.push(math.complex(val[i][j]).im)
                  break;
                case "real":
                  tempRowToSend.push(math.complex(val[i][j]).re)
                  break;
              }
            } catch (e) {console.log(e);}
            if (tempRowToSend.length === expectedLength) throw "end it"
          }
        }
      } catch (e) {console.log(e);}
      //console.log(tempRowToSend);
      tempRowToSend.concat(new Array(expectedLength-tempRowToSend.length).fill(0));
      data.addRow(tempRowToSend);
      while (data.getNumberOfRows() > inParams.storagePoints.Value[0][0]) {
        data.removeRow(0);
      }
    }

    function refreshPlotView() {
      prepareOptions();
      chart.draw(data, options);
    }
    function putInParams(newParams) {
      Object.assign(inParams, newParams);
    }
    function resetPlotView(newParams) {
      if (!!newParams) putInParams(newParams);
      prepareData();
      prepareOptions();
      chart.draw(data, options);
    }
  </script>
  <style>
    html,
    body,
    #chart_div {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>
</head>

<body onresize="refreshPlotView()">
  <div id="chart_div"></div>
</body>

</html>