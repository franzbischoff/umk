function prepareScope(){chart&&chart.dispose(),chart=am4core.create("scope",am4charts.XYChart);const t=chart.xAxes.push(new am4charts.ValueAxis),e=chart.yAxes.push(new am4charts.ValueAxis);t.padding(0,0,0,0),e.padding(0,0,0,0),t.logarithmic=!!settings.xLogScale,e.logarithmic=!!settings.yLogScale,chart.padding(0,32,10,0),chart.legend=new am4charts.Legend,chart.legend.position="top",chart.legend.itemContainers.template.paddingTop=0,chart.legend.itemContainers.template.paddingBottom=0,chart.legend.fontSize=10,chart.legend.useDefaultMarker=!0;var a=chart.legend.markers.template.children.getIndex(0);a.cornerRadius(12,12,12,12),a.strokeWidth=2,chart.cursor=new am4charts.XYCursor,chart.numberFormatter.numberFormat="##.###e",chart.cursor.behavior="zoomXY",prepareColors()}function updateData(t){chart||prepareScope();const e=[];let a=!0;for(let r=0;r<t.length;r++){const o={};for(let e=0;e<t[r].v[0].r.length;e++)for(let n=0;n<t[r].v[0].r[0].length;n++){const s="r_"+(e+1)+"_"+(n+1),i="i_"+(e+1)+"_"+(n+1);settings.xLogScale?(o["x_"+s]=t[r].v[0].r[e][n]>0?t[r].v[0].r[e][n]:NaN,o["x_"+i]=t[r].v[0].i[e][n]>0?t[r].v[0].i[e][n]:NaN):(o["x_"+s]=t[r].v[0].r[e][n],o["x_"+i]=t[r].v[0].i[e][n]);try{settings.yLogScale?(o["y_"+s]=t[r].v[1].r[e][n]>0?t[r].v[1].r[e][n]:NaN,o["y_"+i]=t[r].v[1].i[e][n]>0?t[r].v[1].i[e][n]:NaN):(o["y_"+s]=t[r].v[1].r[e][n],o["y_"+i]=t[r].v[1].i[e][n])}catch(t){o["y_"+s]=NaN,o["y_"+i]=NaN}if(0===chart.data.length&&a){createANewSeries(s,"("+(e+1)+", "+(n+1)+")");const t=createANewSeries(i,"Img("+(e+1)+","+(n+1)+")");settings.showImg||(t.hidden=!0)}}e.push(o),a=!1}let r=chart.data.length+e.length-settings.limitData;r<0&&(r=0),chart.addData(e,r)}function adjustImagSeriesView(){if(chart){const t=chart.series.length/2;for(let e=0;e<t;e++)settings.showImg?chart.series.getIndex(2*e+1).show():chart.series.getIndex(2*e+1).hide()}}function prepareColors(){if(document.getElementsByTagName("html")[0].className=settings.mSettings.theme,chart){for(let t=0;t<chart.xAxes.length;t++)setAxisColorProperties(chart.xAxes.getIndex(t));for(let t=0;t<chart.yAxes.length;t++)setAxisColorProperties(chart.yAxes.getIndex(t));chart.zoomOutButton.background.cornerRadius(5,5,5,5),chart.zoomOutButton.background.fill=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-1"),null).getPropertyValue("border-color")),chart.zoomOutButton.icon.stroke=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-1"),null).getPropertyValue("color")),chart.zoomOutButton.icon.strokeWidth=2,chart.zoomOutButton.background.states.getKey("hover").properties.fill=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-3"),null).getPropertyValue("background-color"))}}function setAxisColorProperties(t){t.setStroke(am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-0"),null).getPropertyValue("color"))),t.strokeWidth=0,t.setFill(am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-0"),null).getPropertyValue("color"))),t.renderer.grid.template.stroke=am4core.color(window.getComputedStyle(document.getElementById("css-ref-ele-0"),null).getPropertyValue("border-color")),t.renderer.grid.template.strokeWidth=1,t.renderer.grid.template.strokeOpacity=.5}function createANewSeries(t,e){const a=chart.series.push(new am4charts.LineSeries);return a.dataFields.valueX="x_"+t,a.dataFields.valueY="y_"+t,a.strokeWidth=2,a.name=e,a.tooltipText="{t}",setChartAnimation(a),a}function setAnimation(t){void 0===t?t=settings.aCharts:settings.aCharts=t;const e=!t;if(chart){for(let t=0;t<chart.series.length;t++){const e=chart.series.getIndex(t);setChartAnimation(e)}chart.hiddenState.transitionDuration=e?0:1e3,chart.defaultState.transitionDuration=e?0:2e3,chart.interpolationDuration=e?0:500,chart.tooltip.animationDuration=e?0:400,chart.xAxes.getIndex(0).hiddenState.transitionDuration=e?0:400,chart.xAxes.getIndex(0).defaultState.transitionDuration=e?0:400,chart.xAxes.getIndex(0).interpolationDuration=e?0:500,chart.xAxes.getIndex(0).tooltip.animationDuration=e?0:400,chart.yAxes.getIndex(0).hiddenState.transitionDuration=e?0:400,chart.yAxes.getIndex(0).defaultState.transitionDuration=e?0:400,chart.yAxes.getIndex(0).interpolationDuration=e?0:500,chart.yAxes.getIndex(0).tooltip.animationDuration=e?0:400}}function setChartAnimation(t,e){void 0===e?e=settings.aCharts:settings.aCharts=e;const a=!e;t.hiddenState.transitionDuration=a?0:700,t.defaultState.transitionDuration=a?0:1e3,t.interpolationDuration=a?0:500,t.tooltip.animationDuration=a?0:400}let chart;const settings={isChartReady:!1,showImg:!1,limitData:1e3,mSettings:{},xLogScale:!1,yLogScale:!1,aCharts:!0};let inData;onmessage=function(t){if(t.data.d&&settings.isChartReady&&updateData(t.data.d),t.data.r&&settings.isChartReady&&prepareScope(),t.data.c){let e=!1;settings.xLogScale!==t.data.c.Parameters.xLogScale.Value[0][0]&&(settings.xLogScale=t.data.c.Parameters.xLogScale.Value[0][0],e=!0),settings.yLogScale!==t.data.c.Parameters.yLogScale.Value[0][0]&&(settings.yLogScale=t.data.c.Parameters.yLogScale.Value[0][0],e=!0),settings.showImg!==t.data.c.Parameters.showIm.Value[0][0]&&(settings.showImg=t.data.c.Parameters.showIm.Value[0][0],adjustImagSeriesView()),settings.limitData=JSON.parse(t.data.c.Parameters.limitData.Value)[0][0],document.title=t.data.c.Name,setAnimation(t.data.c.Parameters.aCharts.Value[0][0]),e&&prepareScope()}t.data.s&&(settings.mSettings=t.data.s,prepareColors())},am4core.ready(function(){settings.isChartReady=!0,am4core.useTheme(am4themes_animated),am4core.useTheme(am4themes_kelly)});