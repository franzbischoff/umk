<!DOCTYPE html>
<html>

<head>
  <title>UYAMAK platform</title>

  <link rel="stylesheet" href="libs-others/w3css-v4/w3.css" />
  <link rel="stylesheet" href="libs-others/w3css-v4/w3-theme-teal.css" />
  <link rel="stylesheet" href="libs-others/fa/css/all.min.css" />

  <link rel="stylesheet" href="css/app.css" />

  <script type="text/javascript">
    mxBasePath = "/libs-others/mxgraph-4.0.4/javascript/src";
  </script>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" href="libs-others/notyf/notyf.min.css" />

  <script type="text/javascript">
    //Default resources are included in grapheditor resources
    mxLoadResources = false;

    window.urlParams = window.urlParams || {};
  </script>
</head>

<body>
  <div id="waitForProcessToFinish" class="w3-modal w3-display-container"
    style="padding-top: 00px; display: block; background-color: #ffffff">
    <div class=" w3-center" style="margin: auto; width: 300px; background-color: #ffffff;">
      <div id="DOMWaitingHead" class="">Loading ...</div>
      <div><i class="fas fa-cog fa-spin fa-2x"></i></div>
      <div id="DOMWaitingDesc" class="">
        If it takes longer than 2 minutes. Check you internet connection and
        try again.
      </div>
    </div>
  </div>
  <div id="mainToobar" class="w3-bar w3-blue-gray" style="padding: 0px 0px">
    <div class="w3-bar-item w3-button tool-item single-tool-item">
      <i class="fa-fw fas fa-home"></i>
    </div>
    <template v-for="(topTool, index) in toolBar">
      <div class="w3-dropdown-hover">
        <div class="w3-button tool-item" @mouseleave="hideInfo()" @mouseover="showInfo(topTool.text)">
          <span><i v-if="!!topTool.icon" v-bind:class="topTool.icon"></i></span>
          <span v-html="topTool.value"></span>
        </div>
        <div class="w3-dropdown-content w3-bar-block w3-card-4" v-bind:style="'width: ' + (topTool.width) + 'px;'">
          <template v-for="(tool, index) in topTool.items">
            <hr v-if="tool.value === 'hl'" style="margin:0; border-color: #ddd;" />
            <div v-else class="w3-bar-item w3-button" style="padding: 0px; vertical-align: middle;"
              v-bind:onclick="(tool.function)" @mouseleave="hideInfo()" @mouseover="showInfo(tool.text)">
              <div class="w3-display-container" style="height: 30px; margin: 0 4px;">
                <div class="w3-display-left">
                  <span class="w3-xlarge" style="display:inline-block; vertical-align:middle"><i v-if="!!tool.icon"
                      class="fa-fw" v-bind:class="tool.icon"></i></span>
                  <span style="margin-left: 0.25em;display:inline-block; vertical-align:middle"
                    v-html="tool.value"></span>
                </div>
                <div class="w3-display-right">
                  <div style="margin-left: 0.25em;display:inline-block; vertical-align:middle;">
                    <template v-for="(key, index) in tool.shortcut">
                      <span v-if="index!==0" style="padding:0;">+</span><span
                        class="w3-light-gray w3-round w3-border w3-border-black"
                        style="padding: 0 2px; font-family: 'Courier New', Courier, monospace; font-weight: bold;"
                        v-html="key"></span>
                    </template>
                  </div>
                </div>
              </div>
            </div>
            <!--div v-else class="w3-bar-item w3-button w3-display-container"  style="height: 35px;">
            <div class="w3-display-left" style="margin-left: 4px;">
            </div>
            <div class="w3-display-right" style="margin-right: 4px;">
              <template v-for="(key, index) in tool.shortcut">
                <span v-if="index!==0" style="padding:0;">+</span><span class="w3-light-gray w3-round w3-border w3-border-black" style="padding: 0 2px; font-family: 'Courier New', Courier, monospace; font-weight: bold;" v-html="key"></span>
              </template>
            </div>
          </div-->
          </template>
        </div>
      </div>
    </template>
    <div id="simulationToolForBar">
      <div class="w3-bar-item w3-button tool-item single-tool-item w3-right">
        <i class="fas fa-play"></i> / <i class="fas fa-stop"></i>
      </div>
    </div>
  </div>
  <div id="flex" style="height:calc(100% - 38.92px)">
    <div id="flex-1" style="overflow:auto;">
      <div class="w3-block w3-khaki w3-hover-yellow w3-button" style="padding: 0 8px; height:22px;"
        onclick="hideSidesOnMainSplit()">
        <div class="w3-right">
          <i class="fas fa-sign-out-alt fa-rotate-180"></i>
        </div>
        <div class="w3-left">
          Hide
        </div>
      </div>
      <div id="allTheBlocks" style="height: calc(100% - 22px)">
        <div class="w3-light-gray" style="width: 100%; overflow: hidden; height: 23px;">
          <div class="w3-hover-text-theme" onclick="document.getElementById('blockSearchBar').focus();document.getElementById('blockSearchBar').select()" style="float: left; width:22px; text-align: center;"><i class="fa-fw fas fa-search"></i></div>
          <div style="float: left; width: calc(100% - 44px);">
              <input id="blockSearchBar" v-model="searchText" type="text" class="w3-input w3-border-0 w3-light-gray" style="padding: 0px; outline:none;" placeholder="Search blocks">
          </div>
          <div class="w3-hover-text-red" @click="searchText=''" style="float: right; width:22px; text-align: center;"><i class="fa-fw fas fa-times"></i></div>
        </div>
        <div style="overflow-y: auto; height: calc(100% - 23px)">
          <div v-if="!!searchText">
            <div class="w3-theme-d1 w3-hover-theme w3-border w3-border-theme" style="width: 100%; padding: 0;"><span>Search results</span></div>
            <div class="w3-border w3-border-theme" style="line-height: 1px; font-size: 1px;">
              <template v-for="(bDetails, bIndex) in searchResults">
                  <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
              </template>
            </div>
          </div>
          <template v-for="(category, cIndex) in categories">
            <div :key= "updateCounter+'_'+category.name+'_'+dispCategories[cIndex]" class="w3-theme-d1 w3-hover-theme w3-border w3-border-theme" style="width: 100%; cursor: pointer; padding: 0;" @click="toggleCategoryDisplay(cIndex)">
              <span>
                <i v-if="dispCategories[cIndex]" class="fa-fw fas fa-caret-down"></i>
                <i v-if="!dispCategories[cIndex]" class="fa-fw fas fa-caret-right"></i>
              </span>
              <span>{{category.name}}</span>
            </div>
            <div :key= "updateCounter+'_'+category.name+'_blocksCont'" v-if="dispCategories[cIndex]" :id="'BlocksOf_'+category.id" class="w3-border w3-border-theme" style="line-height: 1px; font-size: 1px;">
              <template v-for="(bDetails, bIndex) in blocksPerCategory[category.id]">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
                <img :src="getBlockImage(bDetails)" width="50px" height="50px" style="cursor: move;" :title="bDetails.name + '\n' + bDetails.description" class="libraryBlock" :umk_width="bDetails.width" :umk_height="bDetails.height" :umk_color="bDetails.bg">
              </template>
            </div>
          </template>
        </div>
      </div>
    </div>
    <div id="flex-2" style="overflow:auto;">
      <div style="height:100%; width:100%; position:relative;">
        <div id="modelContainer" class="umk_main" style="height:100%;width:100%;"></div>
        <div id="outlineContainer" class="w3-hide-small w3-hide-medium"
          style="position: absolute;overflow:hidden;top:5px;right:5px;width:200px;height:140px;background:transparent;border-style:solid;border-color:black;">
        </div>
      </div>
    </div>
    <div id="flex-3" style="overflow:auto;">
      <div class="w3-block w3-khaki w3-hover-yellow w3-button" style="padding: 0 8px; height:22px;"
        onclick="hideSidesOnMainSplit(false)">
        <div class="w3-left">
          <i class="fas fa-sign-out-alt"></i>
        </div>
        <div class="w3-right">
          Hide
        </div>
      </div>
      <div class="w3-row w3-gray" style="height:29px;">
        <div class="w3-col s6 w3-button rTabLink w3-large zeroPadding w3-border w3-border-black  w3-blue"
          onclick="selectTabItem(event,'editorForParameters','rTabLink', 'rTabContent')">
          <i class="far fa-edit"></i>
        </div>
        <div class="w3-col s6 w3-button rTabLink w3-large zeroPadding w3-border w3-border-black"
          onclick="selectTabItem(event,'simulation','rTabLink', 'rTabContent')">
          <i class="fas fa-play"></i>
        </div>
      </div>
      <div style="overflow:auto; height:calc(100% - 51px);">
        <div class="rTabContent" id="editorForParameters">
          <div v-if="!!cellModel.model">
            <div>
              <p class="w3-large" style="margin:0px;">
                <b>Connection name</b>
              </p>
              <input class="w3-input w3-border w3-border-theme" v-model.trim="cellModel.value" type="text"
                placeholder="Enter a name" />
              <div class="w3-container w3-pale-yellow" v-html="cellModel.value"></div>
            </div>
            <div class="w3-block w3-theme w3-hover-green w3-button" @click="applyCellValue">
              <div class="w3-right">
                <i class="fas fa-check"></i>
              </div>
              <div class="w3-left">
                Appy
              </div>
            </div>
          </div>
          <div v-else-if="!!uyamakModel">
            <div>
              <p class="w3-large" style="margin:0px;"><b>Block name</b></p>
              <input class="w3-input w3-border w3-border-theme" v-model.trim="uyamakModel.Name" type="text" />
              <div class="w3-container w3-pale-yellow" v-html="uyamakModel.Name"></div>
            </div>
            <div v-if="uyamakModel.TerminalsIn.editable">
              <p class="w3-large" style="margin:0px;">
                <b>Input terminals count</b>
              </p>
              <input class="w3-input w3-border w3-border-theme" v-model.number="uyamakModel.TerminalsIn.value"
                type="number" v-bind:min="uyamakModel.TerminalsIn.min" v-bind:max="uyamakModel.TerminalsIn.max" />
            </div>
            <div v-if="uyamakModel.TerminalsOut.editable">
              <p class="w3-large" style="margin:0px;">
                <b>Output terminals count</b>
              </p>
              <input class="w3-input w3-border w3-border-theme" v-model.number="uyamakModel.TerminalsOut.value"
                type="number" v-bind:min="uyamakModel.TerminalsOut.min" v-bind:max="uyamakModel.TerminalsOut.max" />
            </div>
            <div v-if="Object.keys(uyamakModel.Parameters).length>0">
              <p class="w3-large" style="margin:0px;"><b>Parameters</b></p>
              <template v-for="(Parameter, index) in uyamakModel.Parameters">
                <div class="w3-theme-d3 w3-border w3-border-theme w3-ripple" @click="toggleParamDisplay(index)"
                  style="cursor: pointer;">
                  <span v-if="!!parametersDisplay[index]" :key="index+'_'+updatingCounter"><i
                      class="fas fa-caret-down fa-fw"></i></span>
                  <span v-else :key="index+'_'+updatingCounter"><i class="fas fa-caret-right fa-fw"></i></span>
                  <span v-html="Parameter.Name"></span>
                </div>
                <div v-if="!!parametersDisplay[index]">
                  <div v-if="(Parameter.Dimension === 'Vector') || (Parameter.Dimension === 'Matrix')"
                    class="w3-center w3-border-bottom w3-border-theme w3-theme-d1">
                    <div @click="valueDimensionsModify(0, index)" style="width: 40px; height: 40px; padding:0px;"
                      v-if=""
                      class="w3-circle w3-button w3-theme-l3 w3-hover-theme w3-ripple w3-border w3-border-theme w3-display-container rotateNote">
                      <div class="w3-display-middle">
                        <i class="fas fa-ellipsis-h"></i><i class="fas fa-plus-circle"></i>
                      </div>
                    </div>
                    <div @click="valueDimensionsModify(1, index)" style="width: 40px; height: 40px; padding:0px;"
                      v-if=""
                      class="w3-circle w3-button w3-theme-l3 w3-hover-theme w3-ripple w3-border w3-border-theme w3-display-container rotateNote">
                      <div class="w3-display-middle">
                        <i class="fas fa-ellipsis-h"></i><i class="fas fa-minus-circle fa-rotate-90"></i>
                      </div>
                    </div>
                    <div v-if="(Parameter.Dimension === 'Matrix')" @click="valueDimensionsModify(2, index)"
                      style="width: 40px; height: 40px; padding:0px;" v-if=""
                      class="w3-circle w3-button w3-theme-l3 w3-hover-theme w3-ripple w3-border w3-border-theme w3-display-container">
                      <div class="w3-display-middle">
                        <i class="fas fa-ellipsis-h"></i><i class="fas fa-plus-circle"></i>
                      </div>
                    </div>
                    <div v-if="(Parameter.Dimension === 'Matrix')" @click="valueDimensionsModify(3, index)"
                      style="width: 40px; height: 40px; padding:0px;" v-if=""
                      class="w3-circle w3-button w3-theme-l3 w3-hover-theme w3-ripple w3-border w3-border-theme w3-display-container">
                      <div class="w3-display-middle">
                        <i class="fas fa-ellipsis-h"></i><i class="fas fa-minus-circle"></i>
                      </div>
                    </div>
                  </div>
                  <div class="w3-responsive">
                    <table class="w3-table-all">
                      <template v-for="(rowValue, index1) in uyamakModel.Parameters[index]['Value']">
                        <tr v-if="(index1 === 0) && (Parameter.Dimension === 'Matrix')" style="padding: 0;">
                          <td class="w3-light-gray w3-border w3-border-theme"></td>
                          <template v-for="(value, index2) in uyamakModel.Parameters[index]['Value'][index1]">
                            <td style="padding:0;" class="w3-light-gray w3-center w3-border w3-border-theme">
                              {{ index2 + 1 }}
                            </td>
                          </template>
                        </tr>
                        <tr style="padding: 0;" class="w3-border-theme">
                          <td v-if="(Parameter.Dimension === 'Vector') || (Parameter.Dimension === 'Matrix')"
                            style="padding:0; vertical-align: middle;" class="w3-light-gray w3-border w3-border-theme">
                            {{ index1 + 1 }}
                          </td>
                          <template v-for="(value, index2) in uyamakModel.Parameters[index]['Value'][index1]">
                            <td style="padding: 0;" class="w3-border w3-border-theme">
                              <input v-if="(['Integer', 'Real', 'Complex', 'Text'].indexOf(Parameter.Type))>=0"
                                v-bind:class="(!validateParamCellEntry(index, index1, index2))? 'w3-red':''"
                                v-model.trim="uyamakModel.Parameters[index]['Value'][index1][index2]"
                                class="w3-input w3-border-0" style="padding: 0; min-width: 75px; padding: 8px 0px;"
                                v-bind:style="(Parameter.Type !== 'Text')?'text-align: right':''" type="text" />
                              <input v-if="Parameter.Type === 'Color'"
                                v-bind:class="(!validateParamCellEntry(index, index1, index2))? 'w3-red':''"
                                v-model.trim="uyamakModel.Parameters[index]['Value'][index1][index2]"
                                class="w3-input w3-border-0"
                                style="padding: 0; min-width: 75px; padding: 0px; min-height: 35px;"
                                v-bind:style="(Parameter.Type !== 'Text')?'text-align: right':''" type="color" />
                              <select v-if="Parameter.Type === 'Options'" class="w3-select w3-border-0"
                                v-model="uyamakModel.Parameters[index]['Value'][index1][index2]">
                                <template v-for="(opnName, opnVal) in uyamakModel.Parameters[index]['Options']">
                                  <option v-bind:value="opnVal">{{
                                      opnName
                                    }}</option>
                                </template>
                              </select>
                            </td>
                          </template>
                        </tr>
                      </template>
                    </table>
                  </div>
                </div>
              </template>
            </div>
            <div>
              <template v-if="invalidInputs.length>0">
                <p class="w3-large" style="margin:0px;">
                  <b>Input error(s)</b>
                </p>
                <div v-html="inputErrors" class="w3-text-red"></div>
              </template>
              <template v-else-if="parametersValidationComments !== 'OK'">
                <p class="w3-large" style="margin:0px;">
                  <b>Incompatable parameters</b>
                </p>
                <div v-html="parametersValidationComments"></div>
              </template>
              <template v-else>
                <p class="w3-large" style="margin:0px;">
                  <b>Functionality</b>
                </p>
                <div style="overflow-x: auto; overflow-y: hidden;">
                  <div v-html="getBlockDetails()"></div>
                </div>
                <div class="w3-button w3-ripple w3-lime w3-hover-green w3-bar w3-large" @click="saveModel()">
                  <div class="w3-left">Apply</div>
                  <div class="w3-right"><i class="far fa-save"></i></div>
                </div>
                <div class="w3-button w3-ripple w3-amber w3-hover-red w3-bar w3-large"
                  onclick="changeEditModelWithSelectedBlock()">
                  <div class="w3-left">Reset changes</div>
                  <div class="w3-right"><i class="fas fa-undo-alt"></i></div>
                </div>
              </template>
              <label>Icon orientation</label>
              <div class="w3-row">
                <div class="w3-col s12 m6 l3">
                  <div class="w3-button w3-theme-d1 w3-hover-theme w3-ripple w3-bar w3-xlarge" @click="rotate(0)">
                    <i class="far fa-smile"></i>
                  </div>
                </div>
                <div class="w3-col s12 m6 l3">
                  <div class="w3-button w3-theme-d1 w3-hover-theme w3-ripple w3-bar w3-xlarge" @click="rotate(90)">
                    <i class="far fa-smile fa-rotate-90"></i>
                  </div>
                </div>
                <div class="w3-col s12 m6 l3">
                  <div class="w3-button w3-theme-d1 w3-hover-theme w3-ripple w3-bar w3-xlarge" @click="rotate(180)">
                    <i class="far fa-smile fa-rotate-180"></i>
                  </div>
                </div>
                <div class="w3-col s12 m6 l3">
                  <div class="w3-button w3-theme-d1 w3-hover-theme w3-ripple w3-bar w3-xlarge" @click="rotate(270)">
                    <i class="far fa-smile fa-rotate-270"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div v-else>Select a block to edit its parameters.</div>
        </div>
        <div class="rTabContent" style="display: none;" id="simulation">
          <div v-if="available">
            <div class="w3-button w3-ripple w3-bar w3-teal w3-hover-light-green" @click="showExecutionOrder">
              <div class="w3-right">
                <i class="fas fa-sort-numeric-up-alt"></i>
              </div>
              <div class="w3-left">
                Show execution order
              </div>
            </div>
            <label>Sampling time ($T_S$)</label>
            <input class="w3-input w3-border w3-border-blue" v-model="sParams.Ts" v-on:blur="validateParams" />
            <label>Simulation duration ($T$)</label>
            <input class="w3-input w3-border w3-border-blue" v-model="sParams.T_E" v-on:blur="validateParams" />
            <div class="w3-button w3-ripple w3-bar w3-green w3-hover-light-green" @click="run">
              <div class="w3-right">
                <i class="fas fa-play"></i>
              </div>
              <div class="w3-left">
                Run/Continue
              </div>
            </div>
            <div class="w3-button w3-ripple w3-bar w3-teal w3-hover-light-green" @click="pause">
              <div class="w3-right">
                <i class="fas fa-pause"></i>
              </div>
              <div class="w3-left">
                Pause
              </div>
            </div>
            <div class="w3-button w3-ripple w3-bar w3-green w3-hover-light-green" @click="stop">
              <div class="w3-right">
                <i class="fas fa-stop"></i>
              </div>
              <div class="w3-left">
                Stop/Reset
              </div>
            </div>
            <div class="w3-button w3-ripple w3-bar w3-teal w3-hover-light-green" @click="runNSteps">
              <div class="w3-right">
                <i class="fas fa-step-forward"></i>
              </div>
              <div class="w3-left">
                Step
              </div>
            </div>
            <label>Number of steps ($N$)</label>
            <input class="w3-input w3-border w3-border-blue" type="number" min="2" step="1" v-model.number="sParams.N"
              v-on:blur="validateParams" />
            <div class="w3-button w3-ripple w3-bar w3-green w3-hover-light-green" @click="runNSteps(false)">
              <div class="w3-right">
                <i class="fas fa-fast-forward"></i>
              </div>
              <div class="w3-left">
                $N$-steps
              </div>
            </div>
            <input id="sRealtime" class="w3-check" type="checkbox" v-model="sParams.sRealtime" />
            <label for="sRealtime">Real time simulation</label>
            <br />
            <input id="showOutputs" class="w3-check" type="checkbox" v-model="sParams.showOuts" />
            <label for="showOutputs">Show all the outputs (Not recommended)</label>
          </div>
          <div v-else>
            <h3>Cannot simulate</h3>
            <p>Your browser doesn't support multi threading.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="statusBar" class="umk_main w3-bar w3-dark-grey w3-tiny">
    <div style="padding: 0px; display: inline-block;">
      <span><i class="fas fa-info-circle"></i></span>
      <span id="infoInStatus"></span>
    </div>
    <div id="stateOfSystem" class="w3-bar-item w3-right" style="padding: 0px; display: inline-block;">
      Design
    </div>
    <div id="showWhenSimulating" class="w3-bar-item w3-right"
      style="display: inline-block; padding: 0px; margin: 0 8px;">
      <span>$t=$&nbsp;</span>
      <span id="simulationTime">0</span>
      <span><i class="fas fa-ellipsis-v"></i></span>
      <span>Actual $T_S=$&nbsp;</span>
      <span id="aSimulationTime">NaN</span>
      <span><i class="fas fa-ellipsis-v"></i></span>
    </div>
  </div>

  <script src="libs-others/math-js/math.min.js"></script>
  <script src="libs-others/MathJax-2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script src="libs-others/augmented-json-serialization-functions.js"></script>
  <script src="libs-others/notyf/notyf.min.js"></script>
  <script src="libs-others/vue/vue.min.js"></script>
  <script src="libs-others/split-js/split.min.js"></script>

  <script type="text/javascript" src="libs-others/mxgraph-4.0.4/javascript/src/js/mxClient.js"></script>

  <!--Uyamak libraries-->
  <script src="libs/umk-block-categories.js?v=0.1"></script>
  <script src="libs/umk-block-summary.js?v=0.2"></script>
  <script>
  </script>

  
  <script>
    function holdToFinishAProcess(title = null, description = null) {
      if (title)
        document.getElementById("waitForProcessToFinish").style.display =
        "block";
      else
        document.getElementById("waitForProcessToFinish").style.display =
        "none";
      if (title) document.getElementById("DOMWaitingHead").innerText = title;
      if (description)
        document.getElementById("DOMWaitingDesc").innerText = description;
    }
  </script>


  <script>

    //Split related code
    //not universally used
    if (typeof ResizeObserver !== "undefined") {
      new ResizeObserver(function () {
        /*if (typeof graph1 !== "undefined"){ graph1.grid.repaintGrid();
        }
        if (typeof outln !== "undefined") outln.refresh();*/
      }).observe(modelContainer);
    }

    function hideSidesOnMainSplit(isLeft = true, isHide = true) {
      var presentSplit = mainSplit.getSizes();
      if (isHide) {
        if (isLeft) {
          mainSplit.setSizes([
            0,
            presentSplit[0] + presentSplit[1],
            presentSplit[2]
          ]);
        } else {
          mainSplit.setSizes([
            presentSplit[0],
            presentSplit[1] + presentSplit[2],
            0
          ]);
        }
      } else {
        mainSplit.setSizes([15, 60, 25]);
      }
    }
    var mainSplit = Split(["#flex-1", "#flex-2", "#flex-3"], {
      minSize: 0,
      snapOffset: 100,
      sizes: [15, 60, 25],
      gutterSize: 4,
      onDrag: function () {
        /*if (typeof graph1 !== "undefined"){ graph1.grid.repaintGrid();
        }
        if (typeof outln !== "undefined") outln.refresh();*/
      },
      elementStyle: function (dimension, size, gutterSize) {
        return {
          "flex-basis": "calc(" + size + "% - " + gutterSize + "px)"
        };
      },
      gutterStyle: function (dimension, gutterSize) {
        return {
          "flex-basis": gutterSize + "px"
        };
      }
    });
  </script>
  <script>
    //MathJax setup
    MathJax.Hub.Config({
      showMathMenu: false,
      messageStyle: "none",
      menuSettings: {
        inTabOrder: false
      },
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        preview: "none",
        inlineMath: [
          ["$", "$"],
          ["\\(", "\\)"]
        ],
        displayMath: [
          ["$$", "$$"],
          ["\\[", "\\]"]
        ]
      }
    });
  </script>
  <script>
    Graph = function (container) {
      mxGraph.call(this, container);
      this.setBackgroundColor = function (val) {
        container.style.backgroundColor = val;
      };
      //Draws grid
      var Canvas = document.createElement("canvas");
      Canvas.style.position = "absolute";
      Canvas.style.top = "0px";
      Canvas.style.left = "0px";
      //Canvas.style.zIndex = -1;//It may effect the blocks and its selection ... todo
      container.appendChild(Canvas);
      this.grid = {
        gridColor: "#000000",
        canvas: Canvas,
        sGraph: this,
        minorStroke: {
          color: "#f08080",
          thickness: 0.5,
          pattern: [10,2],
          show: true
        },
        majorStroke: {
          color: "#f08080",
          thickness: 1,
          pattern: [5,2],
          show: true
        },
        megaStroke: {
          color: "#f08080",
          thickness: 2,
          pattern: [7,2],
          show: true
        },
        repaintGrid: function () {
          var graph = this.sGraph;
          var s = 0;
          var gs = 0;
          var tr = new mxPoint();
          var w = 0;
          var h = 0;
          var ctx = this.canvas.getContext("2d");
          ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          if (ctx != null) {
            var bounds = graph.getGraphBounds();
            var width = Math.max(
              bounds.x + bounds.width,
              graph.container.clientWidth
            );
            var height = Math.max(
              bounds.y + bounds.height,
              graph.container.clientHeight
            );
            var sizeChanged = width != w || height != h;
            if (
              graph.view.scale != s ||
              graph.view.translate.x != tr.x ||
              graph.view.translate.y != tr.y ||
              gs != graph.gridSize ||
              sizeChanged
            ) {
              tr = graph.view.translate.clone();
              s = graph.view.scale;
              gs = graph.gridSize;
              w = width;
              h = height;
              if (!sizeChanged) {
                ctx.clearRect(0, 0, w, h);
              } else {
                this.canvas.setAttribute("width", w);
                this.canvas.setAttribute("height", h);
              }
              var tx = tr.x * s;
              var ty = tr.y * s;
              var minStepping = graph.gridSize;
              var stepping = minStepping * s;
              if (stepping < minStepping) {
                var count =
                  Math.round(Math.ceil(minStepping / stepping) / 2) * 2;
                stepping = count * stepping;
              }
              var xs = Math.floor((0 - tx) / stepping) * stepping + tx;
              var xe = Math.ceil(w / stepping) * stepping;
              var ys = Math.floor((0 - ty) / stepping) * stepping + ty;
              var ye = Math.ceil(h / stepping) * stepping;
              xe += Math.ceil(stepping);
              ye += Math.ceil(stepping);
              var ixs = Math.round(xs);
              var ixe = Math.round(xe);
              var iys = Math.round(ys);
              var iye = Math.round(ye);
              ctx.strokeStyle = this.minorStroke.color;
              ctx.beginPath();
              ctx.setLineDash(this.minorStroke.pattern);
              ctx.lineWidth = this.minorStroke.thickness;
              for (var x = xs; x <= xe; x += stepping) {
                x = Math.round((x - tx) / stepping) * stepping + tx;
                var ix = Math.round(x);
                ctx.moveTo(ix + 0.5, iys + 0.5);
                ctx.lineTo(ix + 0.5, iye + 0.5);
              }
              for (var y = ys; y <= ye; y += stepping) {
                y = Math.round((y - ty) / stepping) * stepping + ty;
                var iy = Math.round(y);
                ctx.moveTo(ixs + 0.5, iy + 0.5);
                ctx.lineTo(ixe + 0.5, iy + 0.5);
              }
              ctx.closePath();
              ctx.stroke();
              ctx.strokeStyle = this.majorStroke.color;
              stepping = stepping * 5;
              xs = Math.floor((0 - tx) / stepping) * stepping + tx;
              xe = Math.ceil(w / stepping) * stepping;
              ys = Math.floor((0 - ty) / stepping) * stepping + ty;
              ye = Math.ceil(h / stepping) * stepping;
              xe += Math.ceil(stepping);
              ye += Math.ceil(stepping);
              ixs = Math.round(xs);
              ixe = Math.round(xe);
              iys = Math.round(ys);
              iye = Math.round(ye);
              ctx.beginPath();
              ctx.setLineDash(this.majorStroke.pattern);
              ctx.lineWidth = this.majorStroke.thickness;
              for (var x = xs; x <= xe; x += stepping) {
                x = Math.round((x - tx) / stepping) * stepping + tx;
                var ix = Math.round(x);
                ctx.moveTo(ix + 0.5, iys + 0.5);
                ctx.lineTo(ix + 0.5, iye + 0.5);
              }
              for (var y = ys; y <= ye; y += stepping) {
                y = Math.round((y - ty) / stepping) * stepping + ty;
                var iy = Math.round(y);
                ctx.moveTo(ixs + 0.5, iy + 0.5);
                ctx.lineTo(ixe + 0.5, iy + 0.5);
              }
              ctx.closePath();
              ctx.stroke();
              ctx.strokeStyle = this.megaStroke.color;
              stepping = stepping * 2;
              xs = Math.floor((0 - tx) / stepping) * stepping + tx;
              xe = Math.ceil(w / stepping) * stepping;
              ys = Math.floor((0 - ty) / stepping) * stepping + ty;
              ye = Math.ceil(h / stepping) * stepping;
              xe += Math.ceil(stepping);
              ye += Math.ceil(stepping);
              ixs = Math.round(xs);
              ixe = Math.round(xe);
              iys = Math.round(ys);
              iye = Math.round(ye);
              ctx.beginPath();
              ctx.setLineDash(this.megaStroke.pattern);
              ctx.lineWidth = this.megaStroke.thickness;
              for (var x = xs; x <= xe; x += stepping) {
                x = Math.round((x - tx) / stepping) * stepping + tx;
                var ix = Math.round(x);
                ctx.moveTo(ix + 0.5, iys + 0.5);
                ctx.lineTo(ix + 0.5, iye + 0.5);
              }
              for (var y = ys; y <= ye; y += stepping) {
                y = Math.round((y - ty) / stepping) * stepping + ty;
                var iy = Math.round(y);
                ctx.moveTo(ixs + 0.5, iy + 0.5);
                ctx.lineTo(ixe + 0.5, iy + 0.5);
              }
              ctx.closePath();
              ctx.stroke();
            }
          }
        }
      };
    };
    mxUtils.extend(Graph, mxGraph);
    graph1 = new Graph(document.getElementById("modelContainer"));
    var mxGraphViewValidateBackground =
        mxGraphView.prototype.validateBackground;
      mxGraphView.prototype.validateBackground = function () {
        try {
          graph1.grid.repaintGrid();
        } catch (e) {console.log(e)}
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        return mxGraphViewValidateBackground.apply(this, arguments);
      };
  </script>

  <script>
var iconText = {
  icon1: "<svg viewBox='-3 -3 106 106' xmlns='http://www.w3.org/2000/svg'><defs><filter id='f0' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceAlpha' stdDeviation='1'/><feOffset dx='0' dy='0' result='offsetblur'/><feMerge><feMergeNode/><feMergeNode in='SourceGraphic'/></feMerge></filter><filter id='f1' x='-50%' y='-50%' width='200%' height='200%'><feOffset result='offOut' in='SourceAlpha' dx='3' dy='3' /><feGaussianBlur result='blurOut' in='offOut' stdDeviation='1' /><feBlend in='SourceGraphic' in2='blurOut' mode='normal' /></filter></defs><g><rect rx='0' height='100' width='100' y='0' x='0' stroke-width='0' fill='",
  icon2: "' filter='url(#f0)'/></g><g stroke-linecap='round' filter='url(#f1)' width='100' height='100' stroke='",
  icon3: "' stroke-width='10' fill='none'>",
  icon4: "</g></svg>"
};
//Code for handling blocks display
var allTheBlocks = new Vue ({
  el: "#allTheBlocks",
  data: {
    categories: umkBlockCategories,
    bSummary: umkBlockSummary,
    dispCategories: new Array(umkBlockCategories.length).fill(false),
    updateCounter: 0,
    blocksPerCategory: {},
    searchText: ""
  },
  mounted: function () {
    this.dispCategories[0] = true;
    this.updateCounter++;

    //Obtaining blocksPerCategory var
      for (var i=0; i<this.bSummary.length; i++) {
        for (var j=0; j<this.bSummary[i].category.length; j++) {
          if (this.bSummary[i].category[j] !=="") {
            if (typeof this.blocksPerCategory[this.bSummary[i].category[j]] === "undefined") {
              this.blocksPerCategory[this.bSummary[i].category[j]] = new Array();
            }
            this.blocksPerCategory[this.bSummary[i].category[j]].push(this.bSummary[i]);
          }
        }
      }

  },
  methods: {
    toggleCategoryDisplay: function (idx) {
      this.dispCategories[idx] = !this.dispCategories[idx];
      this.updateCounter++;
    },
    getBlockImage: function(block){
      return (
        "data:image/svg+xml;charset=utf-8," +
        encodeURIComponent( iconText.icon1 + block.bg + iconText.icon2 + block.fg + iconText.icon3 + block.icon + iconText.icon4));
    }
  },
  updated: function (){
    var AllLibraryBlocks = document.getElementsByClassName("libraryBlock");
    var dragElt = document.createElement("div");
    for (var i=0; i<AllLibraryBlocks.length; i++) {
      var img = AllLibraryBlocks[i];
      dragElt.style.border = "dashed "+ img.getAttribute("umk_color") +" 1px";
      dragElt.style.width = img.getAttribute("umk_width") + "px";
      dragElt.style.height = img.getAttribute("umk_height") + "px";
      var ds = mxUtils.makeDraggable(img, graph1, function (){}, dragElt, 0, 0, true, true);
      ds.setGuidesEnabled(true);
    }
  },
  computed: {
    searchResults: function () {
      return this.bSummary;
    }
  }
});
  </script>


  <script>
    holdToFinishAProcess(false);
  </script>
</body>

</html>