function arrayRemove(e,t){return e.filter(function(e){return e!=t})}function setCookie(e,t,n=31){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var s="expires="+a.toUTCString();document.cookie=e+"="+t+";"+s+";path=/"}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}function launchFullscreen(e=document.documentElement){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function dumpFullscreen(){console.log("document.fullscreenElement is: ",document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement),console.log("document.fullscreenEnabled is: ",document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)}function blockOnDOM(img){let model=img.getAttribute("umk_model"),width=bSummary.blocks[model].width,height=bSummary.blocks[model].height,fg=bSummary.blocks[model].fg,bg=bSummary.blocks[model].bg,Name=bSummary.blocks[model].name[settings.lang],dragElt=document.createElement("div");dragElt.style.border="dashed var(--col-border-1) 1px",dragElt.style.width=width-0+"px",dragElt.style.height=height-0+"px";let addANewBlock=function(graph,evt,cell,x,y){graph.getModel().beginUpdate();try{eval("var modelForVertex = new "+model+"({'Name': '"+Name+"'})");let IconDetails=modelForVertex.Icon(),inLabels=IconDetails.inLabels||[],outLabels=IconDetails.outLabels||[],splStyle="";IconDetails.splStyle&&(splStyle=IconDetails.splStyle);let parent=mainSystem.graph.getSwimlaneAt(x,y);parent||(parent=graph.getDefaultParent());let xx=x-(parent.geometry&&parent.geometry.x?parent.geometry.x:0),yy=y-(parent.geometry&&parent.geometry.y?parent.geometry.y:0);v=graph.insertVertex(parent,null,modelForVertex,xx,yy,width,height,"umk_model;"+splStyle),v.setConnectable(!1),setTermianls(graph,v,"umk_input"),setTermianls(graph,v,"umk_output");let EO=graph.insertVertex(v,null,"",.5,0,0,0,"umk_EO_0",!0);EO.setConnectable(!1);let Details=graph.insertVertex(v,null,modelForVertex.Name,.5,1,0,0,"umk_caption_0",!0);Details.geometry.offset=new mxPoint(0,0),Details.setConnectable(!1),graph.setSelectionCell(v),v.value.Const(),graph.orderCells(!1),setTimeout(()=>{mainSystem.refresh()},50)}catch(e){new Noty({text:GUIText[settings.lang].errUblPlcBlock,timeout:5e3,theme:"nest",type:"error"}).show(),console.log(e)}graph.getModel().endUpdate()};this.ds=mxUtils.makeDraggable(img,mainSystem.graph,addANewBlock,dragElt,0,0,!0,!0),this.ds.setGuidesEnabled(mainSystem.graph.graphHandler.guidesEnabled)}function setTermianls(e,t,n="umk_input"){if(t&&"object"==typeof t){let a,s,r;IconDetails=t.value.Icon(),"umk_input"===n?(a=IconDetails.inLabels||[],s=t.value.TerminalsIn.value,r={x:0,size:{width:28,height:10},offset:{x:-30,y:-5}}):(a=IconDetails.outLabels||[],s=t.value.TerminalsOut.value,r={x:1,size:{width:20,height:10},offset:{x:0,y:-5}});let o=0,i=[];for(let e=0;e<(t.children?t.children.length:0);e++)t.children[e].style.search(n)>=0&&(o<s?(t.children[e].geometry.y=(o+1)/(s+1),t.children[e].setValue(a[o]||"")):i.push(t.children[e]),o++);e.removeCells(i);for(let i=0;i<s-o;i++){let l=e.insertVertex(t,null,a[i+o]||"",r.x,(o+i+1)/(s+1),r.size.width,r.size.height,n,!0);l.geometry.offset=new mxPoint(r.offset.x,r.offset.y)}}}const GSKGenFuncs={preventDefaults:function(e){e.preventDefault(),e.stopPropagation()},isValidFileName:function(e){const t=/^[^\\/:\*\?"<>\|]+$/,n=/^\./,a=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return t.test(e)&&!n.test(e)&&!a.test(e)},download:function(e,t,n){let a=document.createElement("a"),s=new Blob([t],{type:n}),r=window.URL.createObjectURL(s);a.style.display="none",a.href=r,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(r)},makeSVG:function(e,t,n,a,s){return t||(t="#fff"),n||(n="#000"),a||(a=n),"<svg"+(s?" class='"+s+"'":"")+" viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'><g><rect height='100' width='100' fill-opacity='1' fill='"+t+"' stroke-width='1' stroke='"+a+"' /></g><g stroke-linecap='round' width='100' height='100' stroke='"+n+"' stroke-width='5' fill='none'>"+e+"</g></svg>"}},windResizeCallbacks=[],uyamak={},GUIText={"en-us":{hide:"Hide",hide_left_desc:"Hides the left pane",hide_right_desc:"Hides the right pane",errorShortWidth:"Your screen's width is too small to run this app. ",errorShortHeight:"Your screen's height is too small to run this app. ",key_backspace:"Backspace",key_tab:"Tab",key_enter:"Enter",key_shift:"Shift",key_ctrl:"Ctrl",key_alt:"Alt",key_pause:"Pause",key_caps_lock:"Caps lock",key_escape:"Escape",key_page_up:"Page up",key_page_down:"Page down",key_end:"End",key_home:"Home",key_left_arrow:"Left arrow",key_up_arrow:"Up arrow",key_right_arrow:"Right arrow",key_down_arrow:"Down arrow",key_insert:"Insert",key_delete:"Delete",key_0:"0",key_1:"1",key_2:"2",key_3:"3",key_4:"4",key_5:"5",key_6:"6",key_7:"7",key_8:"8",key_9:"9",key_a:"A",key_b:"B",key_c:"C",key_d:"D",key_e:"E",key_f:"F",key_g:"G",key_h:"H",key_i:"I",key_j:"J",key_k:"K",key_l:"L",key_m:"M",key_n:"N",key_o:"O",key_p:"P",key_q:"Q",key_r:"R",key_s:"S",key_t:"T",key_u:"U",key_v:"V",key_w:"W",key_x:"X",key_y:"Y",key_z:"Z",key_left_win:"Left ⊞",key_right_win:"Right ⊞",key_select:"Select",key_num_0:"Num 0",key_num_1:"Num 1",key_num_2:"Num 2",key_num_3:"Num 3",key_num_4:"Num 4",key_num_5:"Num 5",key_num_6:"Num 6",key_num_7:"Num 7",key_num_8:"Num 8",key_num_9:"Num 9",key_mul:"Num *",key_add:"Num +",key_sub:"Num -",key_point:"Num .",key_div:"Num /",key_f1:"F1",key_f2:"F2",key_f3:"F3",key_f4:"F4",key_f5:"F5",key_f6:"F6",key_f7:"F7",key_f8:"F8",key_f9:"F9",key_f10:"F10",key_f11:"F11",key_f12:"F12",key_num_lock:"Num",key_scroll_lock:"Scroll",key_semi_colon:";",key_equal_sign:"=",key_comma:",",key_dash:"-",key_period:".",key_forward_slash:"/",key_grave_accent:"`",key_open_bracket:"[",key_back_slash:"\\",key_close_braket:"]",key_single_quote:"'",settings:"Settings",theme:"Theme","theme-light":"Light mode","theme-dark":"Dark mode",language:"Language","en-us":"English (United states)","es-mx":"Español (México)",sblocks:"Search blocks…",sResults:"Search results",sResDesc:"Blocks matching the search query.",gridLines:"Gridlines",gLinesMinor:"Minor",gLinesMajor:"Major",gLinesMega:"Mega",navi:"Navigation",gridSize:"Grid size",showOutline:"Show outline",guidesEnabled:"Enable guides",oSettings:"Other settings",vManager:"Variable manager",constants:"Constants",variables:"Variables",var:"Variable",value:"Value",errSameBlkConn:"These two terminals are already connected",errInpInpConn:"A source is already connected",errOutOutConn:"Output cannot be connected to another output",errOnlyOneInp:"Only one input can be connected per terminal",errUblPlcBlock:"Unable to use this block. Please contact our support team.",cPolicyText:"We use cookies to improve the performance.",cPolicyLink:"Cookie policy",accept:"Accept",aNewVar:"Add a new variable",save:"Save",cancel:"Cancel",label:"Label",noOfIns:"Input terminals count",noOfOuts:"Output terminals count",preview:"Preview",params:"Parameters",functionality:"Functionality",aChanges:"Apply changes",rChanges:"Reset Changes",orientation:"Orientation",showLabels:"Show  labels",name:"Name",errUnablGrping:"Unable to group the selected items",subModel:"Sub model",enterFileName:"Enter a filename to save",myUmkModel:"myUyamakModel",rRealTime:"Run at real-time",endTime:"End time in seconds (negative for &infin;)",stepSize:"Step size in milliseconds",run:"Run simulation",stop:"Stop simulation",pause:"Pause simulation",nSteps:"Next N-Steps to the simulation",confirmLoss:"This operation will close the present model.\nAny unsaved data will be lost.\n\nDo you want to proceed?",errorGen:"Error: Unable to perform this action",aLoop:"Error: Possible algebraic loop",showExeOrder:"Show execution order",mDesign:"Design mode",mSim:"Simulating",mSimPause:"Simulation paused",k169:"Incompatible browser. Uyamak requires a modern browser to run the simulation.",k170:"There is no model to simulate. Pull blocks from the library and place on the graph.",k171:"Unable to ungroup the selected items",k172:"Unable to decode the parameter value. Try updating the variables.",k173:"Some parameters are incorrect. Please edit blocks with warning symbol.",simErr:"Simulation error",chartLang:"en",sOEvery:"Record output for every X samples",mHis:"History points in the memory per second",hideGraphText:"Hide text inside the blocks",errorParsing:"Unable to parse the input. If required, update your variables in the variable manager.",errParamEntry:"Parameter error",errDetails:"Unknown error. Please contact the support team if  it continous.",errCompat:"Compatibility error. We cannot proceed to save. Please a look at the functionality and correct your parameters.",snapToGrid:"Snap to grid",locFMgr:"Local file manager",saveToLMach:"Save to local machine",loadFrmLMach:"Load from local machine",import:"Import",open:"Open",model:"Uyamak model",vars:"Variables",simSet:"Simulation settings",guiSet:"Editor settings",sFile:"Select a file by clicking here or you can drag and drop your file here.",errFSize:"File is too big to open. Contact support for more information.",errCrpt:"The selected file is empty or corrupted",for:"for",intType:"Integration type",intTs:"Integrals are updated every",wMode:"Wire mode"},"es-mx":{hide:"Esconder",hide_left_desc:"Hides the left pane",hide_right_desc:"Hides the right pane",errorShortWidth:"El ancho de su pantalla es demasiado pequeño para ejecutar esta aplicación.",errorShortHeight:"La altura de su pantalla es demasiado pequeña para ejecutar esta aplicación.",key_backspace:"Backspace",key_tab:"Tab",key_enter:"Enter",key_shift:"Shift",key_ctrl:"Ctrl",key_alt:"Alt",key_pause:"Pause",key_caps_lock:"Caps lock",key_escape:"Escape",key_page_up:"Page up",key_page_down:"Page down",key_end:"End",key_home:"Home",key_left_arrow:"Left arrow",key_up_arrow:"Up arrow",key_right_arrow:"Right arrow",key_down_arrow:"Down arrow",key_insert:"Insert",key_delete:"Delete",key_0:"0",key_1:"1",key_2:"2",key_3:"3",key_4:"4",key_5:"5",key_6:"6",key_7:"7",key_8:"8",key_9:"9",key_a:"A",key_b:"B",key_c:"C",key_d:"D",key_e:"E",key_f:"F",key_g:"G",key_h:"H",key_i:"I",key_j:"J",key_k:"K",key_l:"L",key_m:"M",key_n:"N",key_o:"O",key_p:"P",key_q:"Q",key_r:"R",key_s:"S",key_t:"T",key_u:"U",key_v:"V",key_w:"W",key_x:"X",key_y:"Y",key_z:"Z",key_left_win:"Left ⊞",key_right_win:"Right ⊞",key_select:"Select",key_num_0:"Num 0",key_num_1:"Num 1",key_num_2:"Num 2",key_num_3:"Num 3",key_num_4:"Num 4",key_num_5:"Num 5",key_num_6:"Num 6",key_num_7:"Num 7",key_num_8:"Num 8",key_num_9:"Num 9",key_mul:"Num *",key_add:"Num +",key_sub:"Num -",key_point:"Num .",key_div:"Num /",key_f1:"F1",key_f2:"F2",key_f3:"F3",key_f4:"F4",key_f5:"F5",key_f6:"F6",key_f7:"F7",key_f8:"F8",key_f9:"F9",key_f10:"F10",key_f11:"F11",key_f12:"F12",key_num_lock:"Num",key_scroll_lock:"Scroll",key_semi_colon:";",key_equal_sign:"=",key_comma:",",key_dash:"-",key_period:".",key_forward_slash:"/",key_grave_accent:"`",key_open_bracket:"[",key_back_slash:"\\",key_close_braket:"]",key_single_quote:"'",settings:"Configuraciones",theme:"Tema","theme-light":"Modo de luz","theme-dark":"Modo oscuro",language:"Idioma","en-us":"Inglés Estados Unidos)","es-mx":"Español (México)",sblocks:"Buscar bloques…",sResults:"Resultados de la búsqueda",sResDesc:"Bloques que coinciden con la consulta de búsqueda.",gridLines:"Líneas de cuadrícula",gLinesMinor:"Menor",gLinesMajor:"Mayor",gLinesMega:"Mega",navi:"Navegación",gridSize:"Tamaño de la cuadrícula",showOutline:"Mostrar esquema",guidesEnabled:"Habilitar guías",oSettings:"Otros ajustes",vManager:"Administrador de variables",constants:"Constantes",variables:"Variables",var:"Variable",value:"Valor",errSameBlkConn:"Estos dos terminales ya están conectados",errInpInpConn:"Una fuente ya está conectada",errOutOutConn:"La salida no se puede conectar a otra salida",errOnlyOneInp:"Solo se puede conectar una entrada por terminal",errUblPlcBlock:"No se puede usar este bloque. Por favor contacte a nuestro equipo de soporte.",cPolicyText:"Utilizamos cookies para mejorar el rendimiento.",cPolicyLink:"Política de cookies",accept:"Aceptar",aNewVar:"Agregar una nueva variable",save:"Guardar",cancel:"Cancelar",label:"Etiqueta",noOfIns:"Conteo de terminales de entrada",noOfOuts:"Los terminales de salida cuentan",preview:"Vista previa",params:"Parámetros",functionality:"Funcionalidad",aChanges:"Aplicar los cambios",rChanges:"Restablecer cambios",orientation:"Orientación",showLabels:"Mostrar etiquetas",name:"Nombre",errUnablGrping:"No se pueden agrupar los elementos seleccionados",subModel:"Submodelo",enterFileName:"Ingrese un nombre de archivo para guardar",myUmkModel:"miModeloDeUyamak",rRealTime:"Corre en tiempo real",endTime:"Tiempo de finalización en segundos (negativo para &infin;)",stepSize:"Tamaño de paso en milisegundos",run:"Ejecutar simulación",stop:"Detener la simulación",pause:"Pausa simulación",nSteps:"N pasos siguientes a la simulación",confirmLoss:"Esta operación cerrará el modelo actual.\nCualquier información no guardada se perderá.\n\nQuieres proceder?",errorGen:"Error: no se puede realizar esta acción",aLoop:"Error: Posible lazo algebraico",showExeOrder:"Mostrar orden de ejecución",mDesign:"Modo de diseño",mSim:"Simulando",mSimPause:"Simulación en pausa",k169:"Navegador incompatible. Uyanmak requiere un navegador moderno para ejecutar la simulación.",k170:"No hay modelo para simular. Extraiga bloques de la biblioteca y colóquelos en el gráfico.",k171:"No se pueden desagrupar los elementos seleccionados",k172:"No se puede decodificar el valor del parámetro. Intenta actualizar las variables.",k173:"Algunos parámetros son incorrectos. Edite los bloques con el símbolo de advertencia.",simErr:"Error de simulación",chartLang:"es",sOEvery:"Grabar salida para cada X muestras",mHis:"Puntos de historia en la memoria por segundo",hideGraphText:"Ocultar texto dentro de los bloques",errorParsing:"No se puede analizar la entrada. Si es necesario, actualice sus variables en el administrador de variables.",errParamEntry:"Error de parametro",errDetails:"Error desconocido. Póngase en contacto con el equipo de soporte si es continuo.",errCompat:"Error de compatibilidad No podemos proceder a guardar. Observe la funcionalidad y corrija sus parámetros.",snapToGrid:"Encajar a la cuadricula",locFMgr:"Administrador de archivos locales",saveToLMach:"Guardar en máquina local",loadFrmLMach:"Cargar desde máquina local",import:"Importar",open:"Abierto",model:"Modelo Uyamak",vars:"Variables",simSet:"Configuraciones de simulación",guiSet:"Configuraciones del editor",sFile:"Seleccione un archivo haciendo clic aquí o puede arrastrar y soltar su archivo aquí.",errFSize:"El archivo es demasiado grande para abrir. Póngase en contacto con el soporte para más información.",errCrpt:"El archivo seleccionado está vacío o dañado.",for:"para",intType:"Tipo de integración",intTs:"Se actualiza integrales cada",wMode:"Modo de cable"}},menu=[{icon:"fas fa-file-alt",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"f",keycode:"70",langCode:"key_f"},text:{"en-us":"File","es-mx":"Archivo"},moreInfo:{"en-us":"Menu gives options to manage your files","es-mx":"El menú ofrece opciones para administrar sus archivos"},subMenu:[{icon:"far fa-file",kbShort:{ctrl:!1,alt:!1,shift:!1,key:"",keycode:"",langCode:""},text:{"en-us":"New Uyamak model","es-mx":"Nuevo modelo de Uyamak"},moreInfo:{"en-us":"Lets you create a new Uyamak model","es-mx":"Le permite crear un nuevo modelo Uyamak"},prtBelow:!0,func:"uyamakFileManager.newModel()"},{icon:"fas fa-cloud",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"l",keycode:"76",langCode:"key_l"},text:{"en-us":"Cloud organizer","es-mx":"Organizador de la nube"},moreInfo:{"en-us":"Organize your Uyamak systems on your cloud storage","es-mx":"Organice sus sistemas Uyamak en su almacenamiento en la nube"},prtBelow:!1,func:"alert()"},{icon:"fas fa-save",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"f",keycode:"70",langCode:"key_f"},text:{"en-us":"File manager","es-mx":"Administrador de archivos"},moreInfo:{"en-us":"Lets you import, open and save the model, variables, and settings","es-mx":"Le permite importar, abrir y guardar el modelo, las variables y la configuración"},prtBelow:!0,func:"uyamak.lFManagerVue.showGUI()"},{icon:"fas fa-share-alt-square",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"j",keycode:"74",langCode:"key_j"},text:{"en-us":"Share privately","es-mx":"Comparte en privado"},moreInfo:{"en-us":"Share Uyamak system with your friends and teachers","es-mx":"Comparte el sistema Uyamak con tus amigos y maestros"},prtBelow:!1,func:"alert()"},{icon:"fas fa-share-alt",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"j",keycode:"74",langCode:"key_j"},text:{"en-us":"Make public","es-mx":"Hacer público"},moreInfo:{"en-us":"Publish your Uyamak system to the public","es-mx":"Publica tu sistema Uyamak al público"},prtBelow:!0,func:"alert()"},{icon:"fas fa-print",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"p",keycode:"80",langCode:"key_p"},text:{"en-us":"Print","es-mx":"Impresión"},moreInfo:{"en-us":"Print the Uyamak system","es-mx":"Imprime el sistema Uyamak"},prtBelow:!1,func:"alert()"}]},{icon:"fas fa-project-diagram",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"s",keycode:"83",langCode:"key_s"},text:{"en-us":"System","es-mx":"Sistema"},moreInfo:{"en-us":"Menu gives options to manage your Uyamak system","es-mx":"El menú ofrece opciones para administrar su sistema Uyamak"},subMenu:[{icon:"fas fa-puzzle-piece",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"u",keycode:"85",langCode:"key_u"},text:{"en-us":"Show Uyamak library","es-mx":"Mostrar biblioteca Uyamak"},moreInfo:{"en-us":"Displays the Uyamak library drawer where you can find all the Uyamak models","es-mx":"Muestra el cajón de la biblioteca Uyamak donde puedes encontrar todos los modelos Uyamak"},prtBelow:!1,func:"document.getElementById('btn-blocks').click()"},{icon:"fas fa-edit",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"e",keycode:"69",langCode:"key_e"},text:{"en-us":"Show Model Editor","es-mx":"Mostrar editor de modelos"},moreInfo:{"en-us":"Displays the Uyamak model editor where you can tweak the model settings","es-mx":"Muestra el editor de modelos de Uyamak donde puede ajustar la configuración del modelo"},prtBelow:!1,func:"document.getElementById('btn-edit').click()"},{icon:"fas fa-play",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"s",keycode:"83",langCode:"key_s"},text:{"en-us":"Show Simulation drawer","es-mx":"Mostrar cajón de simulación"},moreInfo:{"en-us":"Mostrar administrador de variables","es-mx":"Muestra el cajón de simulación donde puede ejecutar el sistema Uyamak"},prtBelow:!1,func:"alert()"},{icon:"fas fa-equals",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"v",keycode:"86",langCode:"key_v"},text:{"en-us":"Show variable manager","es-mx":"Mostrar administrador de variables"},moreInfo:{"en-us":"Displays the system constants and lets you add variables to use in your models","es-mx":"Muestra las constantes del sistema y le permite agregar variables para usar en sus modelos"},prtBelow:!0,func:"varManagerVue.showGUI()"},{icon:"far fa-object-group",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"k",keycode:"75",langCode:"key_k"},text:{"en-us":"Create sub-system","es-mx":"Crear subsistema"},moreInfo:{"en-us":"Creates Uyamak sub-system out of the selected Uyamak models","es-mx":"Crea el subsistema Uyamak a partir de los modelos Uyamak seleccionados."},prtBelow:!1,func:"mainSystem.graph.createSubModel()"},{icon:"far fa-object-ungroup",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"k",keycode:"75",langCode:"key_k"},text:{"en-us":"Dismantle sub-system","es-mx":"Desmontar subsistema"},moreInfo:{"en-us":"Dismantles all the selected Uyamak sub-systems.","es-mx":"Desmantela todos los subsistemas Uyamak seleccionados."},prtBelow:!1,func:"mainSystem.graph.ungroupSubModel()"}]},{icon:"fas fa-pen",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"e",keycode:"69",langCode:"key_e"},text:{"en-us":"Edit","es-mx":"Editar"},moreInfo:{"en-us":"Menu gives options to manipulate the Uyamak system","es-mx":"Menú da opciones para manipular el sistema Uyamak"},subMenu:[{icon:"fas fa-cogs",kbShort:{ctrl:!0,alt:!0,shift:!0,key:"s",keycode:"83",langCode:"key_s"},text:{"en-us":"Settings","es-mx":"Configuraciones"},moreInfo:{"en-us":"Lets you change settings","es-mx":"Le permite cambiar configuraciones"},prtBelow:!0,func:"settingsVue.showGUI()"},{icon:"far fa-check-square",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"a",keycode:"65",langCode:"key_a"},text:{"en-us":"Select all","es-mx":"Seleccionar todo"},moreInfo:{"en-us":"Select all the blocks","es-mx":"Selecciona todos los bloques"},prtBelow:!1,func:"mainSystem.graph.setSelectionCells(mainSystem.graph.getChildCells())"},{icon:"far fa-square",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"a",keycode:"65",langCode:"key_a"},text:{"en-us":"Select none","es-mx":"No seleccionar ninguno"},moreInfo:{"en-us":"Deselect all the blocks","es-mx":"Anule la selección de todos los bloques."},prtBelow:!0,func:"mainSystem.graph.setSelectionCells([])"},{icon:"fas fa-cut",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"x",keycode:"88",langCode:"key_x"},text:{"en-us":"Cut","es-mx":"Cortar"},moreInfo:{"en-us":"Copies the selected Uyamak models into the clipboard and deletes the original ones","es-mx":"Copia los modelos Uyamak seleccionados en el portapapeles y elimina los originales."},prtBelow:!1,func:"uyamakCbManager.cut()"},{icon:"fas fa-copy",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"c",keycode:"67",langCode:"key_c"},text:{"en-us":"Copy","es-mx":"Copiar"},moreInfo:{"en-us":"Copies the selected Uyamak models into the clipboard","es-mx":"Copia los modelos Uyamak seleccionados en el portapapeles"},prtBelow:!1,func:"uyamakCbManager.copy()"},{icon:"fas fa-paste",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"v",keycode:"86",langCode:"key_v"},text:{"en-us":"Paste","es-mx":"Pegar"},moreInfo:{"en-us":"Pastes the clipboard Uyamak models to the present Uyamak system","es-mx":"Pega los modelos de portapapeles Uyamak en el sistema Uyamak actual"},prtBelow:!1,func:"uyamakCbManager.paste()"},{icon:"fas fa-clone",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"c",keycode:"67",langCode:"key_c"},text:{"en-us":"Clone","es-mx":"Clon"},moreInfo:{"en-us":"Clones the selected Uyamak models","es-mx":"Clona los modelos Uyamak seleccionados"},prtBelow:!1,func:"uyamakCbManager.clone()"},{icon:"fas fa-trash-alt",kbShort:{ctrl:!1,alt:!1,shift:!1,key:"delete",keycode:"46",langCode:"key_delete"},text:{"en-us":"Delete","es-mx":"Eliminar"},moreInfo:{"en-us":"Delete the selected Uyamak models and Sub-systems","es-mx":"Eliminar los modelos y subsistemas Uyamak seleccionados"},prtBelow:!0,func:"if (mainSystem.graph.isEnabled()) mainSystem.graph.removeCells()"},{icon:"fas fa-undo",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"z",keycode:"90",langCode:"key_z"},text:{"en-us":"Undo","es-mx":"Deshacer"},moreInfo:{"en-us":"Undo the recent changes","es-mx":"Deshacer los cambios recientes"},prtBelow:!1,func:"mainSystem.undoManager.undo()"},{icon:"fas fa-redo",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"z",keycode:"90",langCode:"key_z"},text:{"en-us":"Redo","es-mx":"Rehacer"},moreInfo:{"en-us":"Redo the recent changes","es-mx":"Rehacer los cambios recientes"},prtBelow:!1,func:"mainSystem.undoManager.redo()"}]},{icon:"fas fa-location-arrow",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"n",keycode:"78",langCode:"key_n"},text:{"en-us":"Navigate","es-mx":"Navegar"},moreInfo:{"en-us":"Contains the commands to navigates through the graph","es-mx":"Contiene los comandos para navegar a través del gráfico."},subMenu:[{icon:"fas fa-search-plus",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"add",keycode:"107",langCode:"key_add"},text:{"en-us":"Zoom in","es-mx":"Acercarse"},moreInfo:{"en-us":"Zooms in","es-mx":"Se acerca"},prtBelow:!1,func:"mainSystem.navigate('zoomIn')"},{icon:"fas fa-search-minus",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"subtract",keycode:"109",langCode:"key_sub"},text:{"en-us":"Zoom out","es-mx":"Disminuir el zoom"},moreInfo:{"en-us":"Zooms out","es-mx":"Se aleja"},prtBelow:!1,func:"mainSystem.navigate('zoomOut')"},{icon:"fas fa-compress",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"k_0",keycode:"48",langCode:"key_0"},text:{"en-us":"Original size","es-mx":"Tamaño original"},moreInfo:{"en-us":"Shows the original size. Some items may be out of view. You can see them by scrolling","es-mx":"Muestra el tamaño original. Algunos artículos pueden estar fuera de la vista. Puedes verlos desplazándote"},prtBelow:!1,func:"mainSystem.navigate('zoomActual')"},{icon:"fas fa-expand",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"k_0",keycode:"48",langCode:"key_0"},text:{"en-us":"Fit all","es-mx":"Ajustar todo"},moreInfo:{"en-us":"Shows the complete Uyamak system","es-mx":"Muestra el sistema Uyamak completo."},prtBelow:!0,func:"mainSystem.navigate('fit')"},{icon:"fab fa-vine",kbShort:{ctrl:!0,alt:!0,shift:!0,key:"a",keycode:"65",langCode:"key_a"},text:{"en-us":"System outline","es-mx":"Esquema del sistema"},moreInfo:{"en-us":"Shows outline of the Uyamak system in a small window on the top right corner","es-mx":"Muestra el esquema del sistema Uyamak en una pequeña ventana en la esquina superior derecha"},prtBelow:!1,func:"alert()"}]},{icon:"fas fa-desktop",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"v",keycode:"86",langCode:"key_v"},text:{"en-us":"View","es-mx":"Ver"},moreInfo:{"en-us":"Menu gives different options to visualize the Uyamak system","es-mx":"El menú ofrece diferentes opciones para visualizar el sistema Uyamak"},subMenu:[{icon:"fas fa-desktop",kbShort:{ctrl:!0,alt:!0,shift:!0,key:"f",keycode:"70",langCode:"key_f"},text:{"en-us":"Full screen","es-mx":"Pantalla completa"},moreInfo:{"en-us":"Makes the app run on full screen","es-mx":"Hace que la aplicación se ejecute en pantalla completa"},prtBelow:!1,func:"launchFullscreen()"},{icon:"fas fa-window-minimize",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"m",keycode:"77",langCode:"key_m"},text:{"en-us":"Minimize  subsystem(s)","es-mx":"Minimizar subsistema (s)"},moreInfo:{"en-us":"Minimizes the selected subsystem. If nothing is selected, all the sub-systems will be minimized","es-mx":"Minimiza el subsistema seleccionado. Si no se selecciona nada, todos los subsistemas se minimizarán."},prtBelow:!1,func:"mainSystem.graph.foldItems(true)"},{icon:"fas fa-window-maximize",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"m",keycode:"77",langCode:"key_m"},text:{"en-us":"Maximize  subsystem(s)","es-mx":"Maximizar subsistema (s)"},moreInfo:{"en-us":"Maximizes the selected subsystem. If nothing is selected, all the sub-systems will be maximized","es-mx":"Maximiza el subsistema seleccionado. Si no se selecciona nada, todos los subsistemas se maximizarán"},prtBelow:!0,func:"mainSystem.graph.foldItems(false)"},{icon:"fas fa-sync-alt",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"r",keycode:"82",langCode:"key_r"},text:{"en-us":"Rotate clockwise","es-mx":"Girar en el sentido de las agujas del reloj"},moreInfo:{"en-us":"Rotates the selected blocks in the clockwise direction","es-mx":"Gira los bloques seleccionados en el sentido de las agujas del reloj."},prtBelow:!1,func:"editorVue.rotateAll(true)"},{icon:"fas fa-sync-alt fa-flip-horizontal",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"r",keycode:"82",langCode:"key_r"},text:{"en-us":"Rotate counter-clockwise","es-mx":"Girar en el sentido contrario de las agujas del reloj"},moreInfo:{"en-us":"Rotates the selected blocks in the counter-clockwise direction","es-mx":"Gira los bloques seleccionados en sentido antihorario"},prtBelow:!0,func:"editorVue.rotateAll(false)"},{icon:"fas fa-clone",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"f",keycode:"70",langCode:"key_f"},text:{"en-us":"Bring to front","es-mx":"Traer al frente"},moreInfo:{"en-us":"Bring the selected blocks to the front","es-mx":"Trae los bloques seleccionados al frente"},prtBelow:!1,func:"mainSystem.graph.orderCells(false);mainSystem.refresh()"},{icon:"fas fa-clone fa-rotate-180",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"b",keycode:"66",langCode:"key_b"},text:{"en-us":"Send to back","es-mx":"Mandado hacia atras"},moreInfo:{"en-us":"Send the selected blocks to back","es-mx":"Enviar los bloques seleccionados al fondo"},prtBelow:!1,func:"mainSystem.graph.orderCells(true);mainSystem.refresh()"},{icon:"fas fa-sort-numeric-up-alt",kbShort:{ctrl:!1,alt:!1,shift:!1,key:"",keycode:"",langCode:""},text:{"en-us":"Execution order","es-mx":"Orden de ejecución"},moreInfo:{"en-us":"Shows simulation order and errors","es-mx":"Muestra el orden de simulación y los errores."},prtBelow:!1,func:"simVue.displayExecutionOrder()"}]},{icon:"fas fa-user-alt",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"a",keycode:"65",langCode:"key_a"},text:{"en-us":"Account","es-mx":"Cuenta"},moreInfo:{"en-us":"Menu gives options to manage the user account","es-mx":"El menú ofrece opciones para administrar la cuenta de usuario"},subMenu:[{icon:"fas fa-user-cog",kbShort:{ctrl:!1,alt:!1,shift:!1,key:"",keycode:"",langCode:""},text:{"en-us":"Profile","es-mx":"Perfil"},moreInfo:{"en-us":"Opens another page where you can manage your Uyamak profile","es-mx":"Abre otra página donde puedes administrar tu perfil de Uyamak"},prtBelow:!1,func:"alert()"},{icon:"fas fa-ticket-alt",kbShort:{ctrl:!0,alt:!1,shift:!0,key:"b",keycode:"66",langCode:"key_b"},text:{"en-us":"Extend licence period","es-mx":"Extender el período de licencia"},moreInfo:{"en-us":"Lets you extend the license period","es-mx":"Le permite extender el período de licencia."},prtBelow:!1,func:"alert()"},{icon:"fas fa-door-open",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"w",keycode:"87",langCode:"key_w"},text:{"en-us":"Sign out","es-mx":"desconectar"},moreInfo:{"en-us":"Signing out","es-mx":"Cerrando sesión"},prtBelow:!1,func:"alert()"}]},{icon:"far fa-life-ring",kbShort:{ctrl:!1,alt:!0,shift:!1,key:"h",keycode:"72",langCode:"key_h"},text:{"en-us":"Help","es-mx":"Ayuda"},moreInfo:{"en-us":"Menu gives access to documentation and help","es-mx":"El menú da acceso a la documentación y ayuda"},subMenu:[{icon:"fas fa-book",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"d",keycode:"68",langCode:"key_d"},text:{"en-us":"Documentation","es-mx":"Documentación"},moreInfo:{"en-us":"Takes you to the documentation page","es-mx":"Te lleva a la página de documentación"},prtBelow:!1,func:"alert()"},{icon:"far fa-question-circle",kbShort:{ctrl:!0,alt:!1,shift:!1,key:"h",keycode:"72",langCode:"key_h"},text:{"en-us":"Context help","es-mx":"Ayuda contextual"},moreInfo:{"en-us":"Shows the documentation for the selected Uyamak model","es-mx":"Muestra la documentación para el modelo Uyamak seleccionado."},prtBelow:!0,func:"alert()"},{icon:"fas fa-info",kbShort:{ctrl:!1,alt:!1,shift:!1,key:"",keycode:"",langCode:""},text:{"en-us":"About","es-mx":"Acerca de"},moreInfo:{"en-us":"Shows the documentation for the selected Uyamak model","es-mx":"Muestra la documentación para el modelo Uyamak seleccionado."},prtBelow:!1,func:"alert()"}]}],settings={lang:"en-us",theme:"theme-light",gLinesMinor:!1,gLinesMajor:!0,gLinesMega:!1,showOutline:!1,gridSize:10,guidesEnabled:!0,showLabels:!0,showExeOrder:!1,snapToGrid:!0},suspendUserInterface={suspendOrders:{},addOrder:function(e){let t=Date.now();return this.suspendOrders[t]=e,this.suspendInterface(),t},removeOrder:function(e){delete this.suspendOrders[e],this.suspendInterface()},suspendInterface:function(){document.getElementById("waitForProcessToFinish").style.display=Object.keys(this.suspendOrders).length?"block":"none",document.getElementById("DOMWaitingDesc").innerHTML="<ol><li>"+Object.values(this.suspendOrders).join("</li><li>")+"</li></ol>"}};let toolBarVue;window.addEventListener("resize",e=>{windResizeCallbacks.forEach(t=>{t(e);try{
mainSystem.refresh()}catch(e){}})}),convertAllTheParamsforAModel=function(e){let t={},n={};modifyFor=["Integer","Real","Complex"];for(let t in e.Parameters){let a={};modifyFor.indexOf(e.Parameters[t].Type)>=0&&(a.Value=getTheParameterValueFromEntry(e.Parameters[t].Value)),n[t]=Object.assign({},e.Parameters[t],a)}return t=Object.assign({},e,{Parameters:n}),t},getTheParameterValueFromEntry=function(e){let t=new Array;for(let n=0;n<e.length;n++){let a=new Array(new Array);for(let t=0;t<e[0].length;t++){let s;try{s=parser.evaluate(e[n][t])}catch(a){s=e[n][t]}if((math.isNumber(s)||math.isComplex(s))&&a[0].push(s),math.isMatrix(s)){let e;e=getTheParameterValueFromEntry(s.toArray());for(let t=0;t<e.length;t++){t===a.length&&a.push(new Array);for(let n=0;n<e[0].length;n++)a[t].push(e[t][n])}}}a.forEach(function(e){t.push(e)})}return t},(()=>{function e(e="left",t=!0){let n=t?1:0;document.documentElement.style.setProperty("--"+e+"-bar-size",n),setTimeout(()=>{try{mainSystem.refresh()}catch(e){}},250)}function t(t=[!0,!0]){t.forEach((t,n)=>{e(r[n],t)})}function n(e,n){let r=[];n<a?o||(o=suspendUserInterface.addOrder(GUIText[settings.lang].errorShortHeight)):o&&(suspendUserInterface.removeOrder(o),o=0),e<s?i||(i=suspendUserInterface.addOrder(GUIText[settings.lang].errorShortWidth)):i&&(suspendUserInterface.removeOrder(i),i=0),e<640?r=[!1,!1]:e>=640&&e<960?r=[!0,!1]:e>=960&&(r=[!0,!0]),t(r)}const a=200,s=400,r=["left","right"];let o=0,i=0;n(window.innerWidth,window.innerHeight),windResizeCallbacks.push(e=>{n(e.currentTarget.innerWidth,e.currentTarget.innerHeight)}),document.getElementById("btn-blocks").addEventListener("click",t=>{e("left",!0),window.innerWidth<940&&e("right",!1)}),document.getElementById("btn-edit").addEventListener("click",t=>{e("right",!0),window.innerWidth<940&&e("left",!1)}),document.getElementById("hide-button-left").addEventListener("click",t=>{e("left",!1)}),document.getElementById("hide-button-right").addEventListener("click",t=>{e("right",!1)})})();const menuVue=new Vue({el:"#main-menu",data:{tools:menu,statusVisible:0,updateCounter:0,wMode:!1},watch:{wMode:function(){mainSystem.graph.wMode=this.wMode}},computed:{lang:function(){return this.updateCounter,settings.lang}},methods:{update:function(){this.updateCounter++},showStatus:function(e){this.statusVisible&&this.removeStatus(this.statusVisible),this.statusVisible=footerVue.addHint("<span><i class='fas fa-info-circle'></i>&nbsp;</span><span>"+e+"</span>")},removeStatus:function(){footerVue.removeHint(this.statusVisible),this.statusVisible=0},evalFunc:function(funToExe){eval(funToExe);let classes=document.getElementsByClassName("dropdown-content");for(let e=0;e<classes.length;e++)classes[e].style.visibility="hidden",setTimeout((t=classes[e])=>{t.style.visibility="unset"},500)}}}),footerVue=new Vue({el:"#footer",data:{updateCounter:0,Hints:{},mode:"mDesign",totalTime:5,presTime:0},computed:{textForHint:function(){return this.updateCounter,Object.keys(this.Hints).length?this.Hints[Object.keys(this.Hints)[Object.keys(this.Hints).length-1]]:""},status:function(){let e=GUIText[settings.lang][this.mode];switch(this.mode){case"mSim":return"<i class='fa-fw fas fa-play'></i>&nbsp;"+e;case"mSimPause":return"<i class='fa-fw fas fa-pause'></i>&nbsp;"+e;default:return"<i class='fa-fw fas fa-drafting-compass'></i>&nbsp;"+e}},progress:function(){let e="";return e=this.totalTime<0?"<i class='fas fa-infinity fa-fw'></i>":this.totalTime,"mDesign"===this.mode?"- / "+e:this.totalTime<0?math.parse(this.presTime).toString(4)+" / "+e:math.parse(this.presTime).toString(4)+" / "+e+" = "+math.parse(this.presTime/this.totalTime*100).toString(4)+"%"}},methods:{refreshFooter:function(){this.updateCounter++},addHint:function(e){let t=Date.now();return this.$set(this.Hints,t,e),t},removeHint:function(e){delete this.Hints[e],this.updateCounter++}}}),settingsVue=new Vue({el:"#settings",data:{cThemes:{mode:{dark:"dark",dark2:"dark",dark3:"dark",dark4:"dark",dark5:"dark",light:"light",light2:"light",light3:"light",light4:"light",light5:"light"},"en-us":{"theme-dark":"Dark theme 1","theme-dark2":"Dark theme 2","theme-dark3":"Dark theme 3","theme-dark4":"Dark theme 4","theme-dark5":"Dark theme 5","theme-light":"Light theme 1 (default)","theme-light2":"Light theme 2","theme-light3":"Light theme 3","theme-light4":"Light theme 4","theme-light5":"Light theme 5"},"es-mx":{"theme-dark":"Tema oscuro 1","theme-dark2":"Tema oscuro 2","theme-dark3":"Tema oscuro 3","theme-dark4":"Tema oscuro 4","theme-dark5":"Tema oscuro 5","theme-light":"Tema ligero 1 (predeterminado)","theme-light2":"Tema ligero 2","theme-light3":"Tema ligero 3","theme-light4":"Tema ligero 4","theme-light5":"Tema ligero 5"}},stings:settings,display:!1},mounted:function(){this.setGUITheme()},updated:function(){this.updateHideBtnText()},watch:{display:function(){kbshort.suspend(this.display,function(e){27===e.keyCode&&settingsVue.showGUI(!1)}),settingsVue.display||mainSystem.refresh()},stings:{deep:!0,handler:function(){setCookie("settings",JSON.stringify2(this.stings))}},"stings.lang":{handler:function(){menuVue.update()}},"stings.theme":{handler:function(){this.setGUITheme()}},"stings.showExeOrder":function(){simVue.displayExecutionOrder()}},methods:{setGUITheme:function(){document.getElementsByTagName("html")[0].className=this.stings.theme},showGUI:function(e=!0){this.display=e},updateHideBtnText:function(){document.getElementById("hide-left-text").innerText=GUIText[this.stings.lang].hide,document.getElementById("hide-right-text").innerText=GUIText[this.stings.lang].hide}}});mxConnectionHandler.prototype.movePreviewAway=!1,mxConnectionHandler.prototype.waypointsEnabled=!0,mxGraph.prototype.resetEdgesOnConnect=!1,mxConstants.SHADOWCOLOR="#C0C0C0";var joinNodeSize=7,strokeWidth=2;mxConstraintHandler.prototype.pointImage=new mxImage("images/dot.gif",10,10),mxGraphHandler.prototype.guidesEnabled=!0,mxGuide.prototype.isEnabledForEvent=function(e){return!mxEvent.isAltDown(e)},mxEdgeHandler.prototype.snapToTerminals=!0,mxGraphView.prototype.updateFixedTerminalPoint=function(e,t,n,a){var s=null;if(null!=a&&(s=this.graph.getConnectionPoint(t,a)),n?e.sourceSegment=null:e.targetSegment=null,null==s){var r=this.scale,o=this.translate,i=e.origin,l=this.graph.getCellGeometry(e.cell);if(s=l.getTerminalPoint(n),null!=s){if(s=new mxPoint(r*(o.x+s.x+i.x),r*(o.y+s.y+i.y)),null!=t&&null!=t.absolutePoints){var c=mxUtils.findNearestSegment(t,s.x,s.y),u=t.absolutePoints[c],m=t.absolutePoints[c+1],h=u.x-m.x==0,d=n?"sourceConstraint":"targetConstraint",p=h?"horizontal":"vertical";e.style[d]=p,h?(s.x=u.x,s.y=Math.min(s.y,Math.max(u.y,m.y)),s.y=Math.max(s.y,Math.min(u.y,m.y))):(s.y=u.y,s.x=Math.min(s.x,Math.max(u.x,m.x)),s.x=Math.max(s.x,Math.min(u.x,m.x)))}}else null!=t&&t.cell.geometry.relative&&(s=new mxPoint(this.getRoutingCenterX(t),this.getRoutingCenterY(t)))}e.setAbsoluteTerminalPoint(s,n)},mxConnectionHandler.prototype.createEdgeState=function(e){var t=this.graph.createEdge();if(null!=this.sourceConstraint&&null!=this.previous)t.style=mxConstants.STYLE_EXIT_X+"="+this.sourceConstraint.point.x+";"+mxConstants.STYLE_EXIT_Y+"="+this.sourceConstraint.point.y+";";else if(e&&this.graph.model.isEdge(e.getCell())){var n=this.graph.view.scale,a=this.graph.view.translate,s=new mxPoint(this.graph.snap(e.getGraphX()/n)-a.x,this.graph.snap(e.getGraphY()/n)-a.y);t.geometry.setTerminalPoint(s,!0)}return this.graph.view.createState(t)},mxConnectionHandler.prototype.isStopEvent=function(e){return null!=e.getState()||mxEvent.isRightMouseButton(e.getEvent())},mxConnectionHandlerUpdateCurrentState=mxConnectionHandler.prototype.updateCurrentState,mxConnectionHandler.prototype.updateCurrentState=function(e){if(mxConnectionHandlerUpdateCurrentState.apply(this,arguments),null!=this.edgeState&&(this.edgeState.cell.geometry.setTerminalPoint(null,!1),null!=this.shape&&null!=this.currentState&&this.currentState.view.graph.model.isEdge(this.currentState.cell))){var t=this.graph.view.scale,n=this.graph.view.translate,a=new mxPoint(this.graph.snap(e.getGraphX()/t)-n.x,this.graph.snap(e.getGraphY()/t)-n.y);this.edgeState.cell.geometry.setTerminalPoint(a,!1)}},mxEdgeSegmentHandler.prototype.clonePreviewState=function(e,t){var n=mxEdgeHandler.prototype.clonePreviewState.apply(this,arguments);return n.cell=n.cell.clone(),(this.isSource||this.isTarget)&&(n.cell.geometry=n.cell.geometry.clone(),this.graph.getModel().isEdge(n.cell)?n.cell.geometry.setTerminalPoint(e,this.isSource):n.cell.geometry.setTerminalPoint(null,this.isSource)),n};var mxEdgeHandlerConnect=mxEdgeHandler.prototype.connect;mxEdgeHandler.prototype.connect=function(e,t,n,a,s){var r=null,o=this.graph.getModel();o.getParent(e);o.beginUpdate();try{r=mxEdgeHandlerConnect.apply(this,arguments);var i=o.getGeometry(r);if(null!=i){i=i.clone();var l=null;if(o.isEdge(t)){l=this.abspoints[this.isSource?0:this.abspoints.length-1],l.x=l.x/this.graph.view.scale-this.graph.view.translate.x,l.y=l.y/this.graph.view.scale-this.graph.view.translate.y;var c=this.graph.getView().getState(this.graph.getModel().getParent(e));null!=c&&(l.x-=c.origin.x,l.y-=c.origin.y),l.x-=this.graph.panDx/this.graph.view.scale,l.y-=this.graph.panDy/this.graph.view.scale}i.setTerminalPoint(l,n),o.setGeometry(e,i)}}finally{o.endUpdate()}return r},mxConnectionHandlerCreateMarker=mxConnectionHandler.prototype.createMarker,mxConnectionHandler.prototype.createMarker=function(){var e=mxConnectionHandlerCreateMarker.apply(this,arguments);return e.intersects=function(e,t){return!0},mxCellHighlightHighlight=mxCellHighlight.prototype.highlight,e.highlight.highlight=function(e){this.state!=e&&(null!=this.state&&(this.state.style=this.lastStyle,this.state.style.strokeWidth=this.state.style.strokeWidth||"1",this.state.style.strokeColor=this.state.style.strokeColor||"none",null!=this.state.shape&&(this.state.view.graph.cellRenderer.configureShape(this.state),this.state.shape.redraw())),null!=e&&(this.lastStyle=e.style,e.style=mxUtils.clone(e.style),e.style.strokeColor="var(--col-border-1)",e.style.strokeWidth="3",null!=e.shape&&(e.view.graph.cellRenderer.configureShape(e),e.shape.redraw())),this.state=e)},e},mxEdgeHandlerCreateMarker=mxEdgeHandler.prototype.createMarker,mxEdgeHandler.prototype.createMarker=function(){var e=mxEdgeHandlerCreateMarker.apply(this,arguments);return e.highlight.highlight=this.graph.connectionHandler.marker.highlight.highlight,e},mxGraphGetCellStyle=mxGraph.prototype.getCellStyle,mxGraph.prototype.getCellStyle=function(e){var t=mxGraphGetCellStyle.apply(this,arguments);return null!=t&&this.model.isEdge(e)&&(t=mxUtils.clone(t),this.model.isEdge(this.model.getTerminal(e,!0))&&(t.startArrow="oval"),this.model.isEdge(this.model.getTerminal(e,!1))&&(t.endArrow="oval")),t},mxEdgeStyle.WireConnector=function(e,t,n,a,s){var r=e.absolutePoints,o=!0,i=null;if(null!=t&&e.view.graph.model.isEdge(t.cell))o="horizontal"==e.style.sourceConstraint;else if(null!=t){o="vertical"!=t.style.portConstraint;var l=t.style[mxConstants.STYLE_DIRECTION];"north"!=l&&"south"!=l||(o=!o)}var c=r[0];null==c&&null!=t?c=new mxPoint(e.view.getRoutingCenterX(t),e.view.getRoutingCenterY(t)):null!=c&&(c=c.clone());var u=c;if(null!=a&&a.length>0)for(var m=0;m<a.length;m++)o=!o,i=e.view.transformControlPoint(e,a[m]),o?c.y!=i.y&&(c.y=i.y,s.push(c.clone())):c.x!=i.x&&(c.x=i.x,s.push(c.clone()));else i=c;c=r[r.length-1],null==c&&null!=n&&(c=new mxPoint(e.view.getRoutingCenterX(n),e.view.getRoutingCenterY(n))),o?c.y!=i.y&&u.x!=c.x&&s.push(new mxPoint(c.x,i.y)):c.x!=i.x&&u.y!=c.y&&s.push(new mxPoint(i.x,c.y))},mxStyleRegistry.putValue("wireEdgeStyle",mxEdgeStyle.WireConnector),mxGraphCreateHandler=mxGraph.prototype.createHandler,mxGraph.prototype.createHandler=function(e){if(null!=e&&this.model.isEdge(e.cell)){var t=this.view.getEdgeStyle(e);if(t==mxEdgeStyle.WireConnector)return new mxEdgeSegmentHandler(e)}return mxGraphCreateHandler.apply(this,arguments)},function(){mxVertexHandler.prototype.rotationEnabled=!1,mxVertexHandler.prototype.manageSizers=!0,mxVertexHandler.prototype.livePreview=!0,mxConstants.HANDLE_SIZE=16,mxConstants.LABEL_HANDLE_SIZE=7,(mxClient.IS_TOUCH||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&(mxShape.prototype.svgStrokeTolerance=18,mxVertexHandler.prototype.tolerance=12,mxEdgeHandler.prototype.tolerance=12,mxGraph.prototype.tolerance=12),mxPanningHandler.prototype.isPanningTrigger=function(e){var t=e.getEvent();return null==e.getState()&&!mxEvent.isMouseEvent(t)||mxEvent.isPopupTrigger(t)&&(null==e.getState()||mxEvent.isControlDown(t)||mxEvent.isShiftDown(t))};var e=mxGraphHandler.prototype.mouseDown;mxGraphHandler.prototype.mouseDown=function(t,n){e.apply(this,arguments),this.graph.isCellSelected(n.getCell())&&this.graph.getSelectionCount()>1&&(this.delayedSelection=!1)},mxConnectionHandler.prototype.selectCells=function(e,t){null!=t?this.graph.setSelectionCell(t):this.graph.setSelectionCell(e)};var t=mxGraph.prototype.dblClick;mxGraph.prototype.dblClick=function(e,n){if(null==n){var a=mxUtils.convertPoint(this.container,mxEvent.getClientX(e),mxEvent.getClientY(e));n=this.getCellAt(a.x,a.y)}t.call(this,e,n)};var n=new mxImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABLUlEQVQ4y61US4rCQBBNeojiRrLSnbMOWWU3V1FPouARcgc9hyLOCSSbYZw5gRCIkM9KbevJaycS4zCOBY+iq6pf1y+xrNtiE6oEY/tVzMUXgSNoCJrUDu3qHpldutwSuIKOoEvt0m7I7DoCvNj2fb8XRdEojuN5lmVraJxhh59xFSLFF9phGL7lef6hRb63R73aHM8aAjv8JHJ47yqLlud5r0VRbHa51sPZQVuT/QU4ww4/4ljaJRubrC5SxouD6TWBQV/sEIkbs0eOIVGssSO1L5D6LQID+BHHZjdMSYpj7KZpun7/uk8CP5rNqTXLJP/OpNyTMWruP9CTP08nCILKdCp7gkCzJ8vPnz2BvW5PKhuLjJBykiQLaWIEjTP3o3Zjn/LtPO0rfvh/cgKu7z6wtPPltQAAAABJRU5ErkJggg==",17,17);mxVertexHandler.prototype.handleImage=n,mxEdgeHandler.prototype.handleImage=n,mxOutline.prototype.sizerImage=n,(new Image).src=n.src;var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABLZJREFUeNqcVl1MHFUUPrPMsn8s7UItthFa/ImNRB7aIC0aWyQhpqZWTBMNkQc3PvjiQ4MR05honyQmpjE8mmw01EqMwQcIopYAdUNR0CYYsk37oMIGuru1rEt2Z3Zm7lzPnbl3dlgXqE5ysnfPved85++ecyW4v0/aaZPit6OwJO2oQOLkcf16XKBMuVlGFUG3AxK8Kk5eJLm/v39vNBo9UVtb20gIUTc2NpJDQ0MLsVhsE/d1JAOJcNoCyIAqgTCrq5GCSHVra2vvFQqFON3my+fzs8lk8jyejXAZr/CcYVWKqhskPDExcRyVXBcKVYPSpb8pnUqZNH7XpIkcpRopAaIx06Ojo0dRtobrcMDKk8w2ZCTf1NTUsc7Ozgl0ObCuAHyxSuD7eyYopmRLUFuyFiVO7/PAqw95oN6HMSMkPTs7e66rq+sGniiycDIj3DmSeD58k5OTrd3d3TO4Wf1j2oSLt3RQTVuz2yoMisPZI0tw8XEZjtV7GFhubGzsuZ6engRuaTxnVHJ5w2IbUhTlB7/ff3R6ncCFhMbNt21xwiAJ21gO7KWMzI+e8EJHgwwYxmuhUOgl3ClwMOouXW8qlXqbgfy5acIHSwUwNQOJcDKA6sSiEs+0/xcJaKoB7y+pkFFMCAaDz2KBRHkqqoQnjkdYul3sTyyhQL5ogIHKjSInzaafng9bZGg6JwOIbtM9RYfLN1VLYSQS6eFRsu6jAzQ8PNyE3jyVK5owvlqwFTDluuGsGYmPuHhu+ur3PCgGZV49PTAwEBHOOEAdHR0n2GIppYGKlglPSJEDqvZ/8elq6YybNhUDbv+lWWf6+vraBIYsXKupqTnEGGs5DRUTdrWtG81yfTPa+K9Lt/zaQWd9JLbqrhm4kzOgtcEH4XC4SVwhWRw2TdMyQ0YBDa21SouVlCTt2nE17qm4Yh6OilVKxBmZ71Es6xRj1PmlLSFim02Xbjnmrpx/zFo1XbpdKn1hFD+zL2BnJJvNJsUh4ZE5Pz8/19zcDK0HsV1h6HQmSLcfFHpRdzqEsIjh7ZE9cKQhYLFGRkYWRVcXxWD29vauoFcLdaEqONMYwEpDMCwCh4o2lYC28tmahfDlh4Pg90qAuuKDg4MbAsjxiMliE70WCATa3jq1H75ObGBvo+7hZrWc2gu/Wl5QUSxO05QgjK3ozZP7Rdi+46ODlrcg1nFDqqpO+3y+J6/E78Ab36zwyiv1OgolxaLfCXO+fOUwnG17gLWgeWxBLyArz2eV6XHlnKGry8vL7zJG7zMPwqdnG8FDsGtjGBVsNQWd/ZoWWWvkFzBkfkLg8rlDFghTuri4+A7v3kQUQ8UxgYVxsr29fYwxf/sjBx+PrcDniayrgG1RP3r7eute6H/xMDxyIGhxZ2ZmunDELHAgXYyJ8sFnjQo2+NCq0xjGhBhsa3dV+u1Cmn52dZVemU7SqzcyNJ0tOoMPk/9LPB4/xWS5ji2Dr9KUrRL5QqrPZDKfYMwXtxvlCPBzOp3+kJ3lMtWVRrm0y+tH5h3YOz4+/mhLS8txrMoDKKwh+Prc3Nx17GcrPOE6z4nJ3yb0/zy3PNxTaZfnFv0vz62dHo/l5+n9PCIZ0D8CDACEWhv+nM/wTwAAAABJRU5ErkJggg==",s=mxVertexHandler.prototype.init;mxVertexHandler.prototype.init=function(){if(s.apply(this,arguments),this.graph.connectionHandler.isEnabled()&&1==this.graph.getSelectionCount()&&this.graph.getSelectionCell().style&&this.graph.getSelectionCell().style.search("umk_model")>=0){let e=[],t=mainSystem.graph.getSelectionCell().children;for(let n=0;n<t.length;n++)t[n].style&&(t[n].style.search("umk_input")>=0||t[n].style.search("umk_output")>=0)&&e.push(t[n]);this.genImg=function(e,t){let n=mxUtils.createImage(a);return n.style.cursor="pointer",n.style.width="15px",n.style.height="15px",n.style.position="absolute",mxClient.IS_TOUCH||mxEvent.redirectMouseEvents(n,e,t),mxEvent.addGestureListeners(n,function(n){e.popupMenuHandler.hideMenu(),e.stopEditing(!1);var a=mxUtils.convertPoint(e.container,mxEvent.getClientX(n),mxEvent.getClientY(n));e.connectionHandler.start(t,a.x,a.y),e.isMouseDown=!0,e.isMouseTrigger=mxEvent.isMouseEvent(n),mxEvent.consume(n)}),e.container.appendChild(n),n},this.ports=[];for(let t=0;t<e.length;t++){let n=this.graph.getView().getState(e[t]);this.ports.push({s:n,i:this.genImg(this.graph,n)})}}setTimeout(function(e){e.redrawHandles()},4,this)};var r=mxVertexHandler.prototype.hideSizers;mxVertexHandler.prototype.hideSizers=function(){if(r.apply(this,arguments),this.ports)for(let e=0;e<this.ports.length;e++)null!=this.ports[e].i&&(this.ports[e].i.style.visibility="hidden")};var o=mxVertexHandler.prototype.reset;mxVertexHandler.prototype.reset=function(){if(o.apply(this,arguments),this.ports)for(let e=0;e<this.ports.length;e++)null!=this.ports[e].i&&(this.ports[e].i.style.visibility="")};var i=mxVertexHandler.prototype.redrawHandles;mxVertexHandler.prototype.redrawHandles=function(){if(i.apply(this),this.ports)for(let o=0;o<this.ports.length;o++)if(null!=this.ports[o].s&&null!=this.ports[o].i){var e=new mxPoint,t=this.ports[o].s;mxVertexHandler.prototype.singleSizer?(e.x=t.x-t.width-this.ports[o].i.offsetWidth/2,e.y=t.y-this.ports[o].i.offsetHeight/2):(e.x=t.x+(this.ports[o].s.cell&&this.ports[o].s.cell.style&&this.ports[o].s.cell.style.search("umk_input")>=0?0:t.width),e.y=t.y+t.height/2);var n=mxUtils.toRadians(mxUtils.getValue(t.style,mxConstants.STYLE_ROTATION,0));if(0!=n){var a=Math.cos(n),s=Math.sin(n),r=new mxPoint(t.getCenterX(),t.getCenterY());e=mxUtils.getRotatedPoint(e,a,s,r)}this.ports[o].i.style.left=e.x-this.ports[o].i.offsetWidth/2+"px",this.ports[o].i.style.top=e.y-this.ports[o].i.offsetHeight/2+"px"}};var l=mxVertexHandler.prototype.destroy;mxVertexHandler.prototype.destroy=function(e,t){if(l.apply(this,arguments),this.ports){for(let e=0;e<this.ports.length;e++)this.ports[e].i.parentNode.removeChild(this.ports[e].i),this.ports[e].i=null;this.ports=[]}},(new Image).src=a}();const mainSystem={};((e,t)=>{const n=new mxGraph(e),a=new mxOutline(n,t);mainSystem.graph=n,mainSystem.outline=a,a.container=t})(document.getElementById("modelContainer"),document.getElementById("outlineContainer")),(e=>{e.setAllowDanglingEdges(!1),e.setConnectable(!0),e.setTooltips(!0),e.setPanning(!0),e.setConnectableEdges(!0),e.setDisconnectOnMove(!1),e.setEnterStopsCellEditing(!0),e.validationAlert=function(e){new Noty({text:e,timeout:5e3,theme:"nest",type:"warning"}).show()},e.areAllFromSameNode=function(e,t=[]){const n=this.getNodeCells(e[0],t)[0];for(let a=1;a<e.length;a++){let s=this.getNodeCells(e[a],t),r=!1;for(let e=0;e<s.length;e++)if(n===s[e]){r=!0;break}if(!r)return!1}return!0},e.areAllFromDiffNodes=function(e,t=[]){const n=this.getNodeCells(e[0],t)[0];for(let a=1;a<e.length;a++){let s=this.getNodeCells(e[a],t),r=!1;for(let e=0;e<s.length;e++)if(n===s[e]){r=!0;break}if(r)return!1}return!0},e.doesContainMultipleSources=function(e,t=[]){let n=!1;for(let a=0;a<e.length;a++){let s=this.getNodeCells(e[a],t);for(let e=0;e<s.length;e++)if(s[e].style&&s[e].style.search("umk_output")>=0){if(n)return!0;n=!0}}return!1},e.getNodeCells=function(e,t=[]){const n=[];n.push(e);let a=0;for(;a<n.length;){const e=[];if(n[a].edges)for(let t=0;t<n[a].edges.length;t++)e.push(n[a].edges[t]);n[a].isEdge()&&(e.push(n[a].source),e.push(n[a].target));for(let a=0;a<e.length;a++){let s=!0;for(let t=0;t<n.length;t++)if(e[a]===n[t]){s=!1;break}s&&t.findIndex(function(t){return e[a]===t})<0&&n.push(e[a])}a++}return n}})(mainSystem.graph),(e=>{mxGraph.prototype.createSubModel=function(){let e,t=this.getModel();t.beginUpdate();try{e=this.groupCells(null,35,this.getSelectionCells()),e.geometry.alternateBounds=new mxRectangle(0,0,200,25),this.setSelectionCell(e)}catch(e){return console.log(e),void this.validationAlert(GUIText[settings.lang].errUnablGrping)}finally{return t.endUpdate(),e}},mxGraph.prototype.ungroupSubModel=function(){let e=this.getModel();e.beginUpdate();try{let t=this.getSelectionCells();for(let e=0;e<t.length;e++)if(t[e].getStyle()&&t[e].getStyle().search("umk_group")>=0){let n=this.getSelectionCells();n=n.concat(t[e].children),this.ungroupCells([t[e]]),this.setSelectionCells(n)}}catch(e){console.log(e),validationAlert(GUIText[settings.lang].k171)}finally{e.endUpdate()}},e.collapsedImage=new mxImage("data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjQ0OHB0IiB2aWV3Qm94PSIwIDAgNDQ4IDQ0OCIgd2lkdGg9IjQ0OHB0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im00MDggMTg0aC0xMzZjLTQuNDE3OTY5IDAtOC0zLjU4MjAzMS04LTh2LTEzNmMwLTIyLjA4OTg0NC0xNy45MTAxNTYtNDAtNDAtNDBzLTQwIDE3LjkxMDE1Ni00MCA0MHYxMzZjMCA0LjQxNzk2OS0zLjU4MjAzMSA4LTggOGgtMTM2Yy0yMi4wODk4NDQgMC00MCAxNy45MTAxNTYtNDAgNDBzMTcuOTEwMTU2IDQwIDQwIDQwaDEzNmM0LjQxNzk2OSAwIDggMy41ODIwMzEgOCA4djEzNmMwIDIyLjA4OTg0NCAxNy45MTAxNTYgNDAgNDAgNDBzNDAtMTcuOTEwMTU2IDQwLTQwdi0xMzZjMC00LjQxNzk2OSAzLjU4MjAzMS04IDgtOGgxMzZjMjIuMDg5ODQ0IDAgNDAtMTcuOTEwMTU2IDQwLTQwcy0xNy45MTAxNTYtNDAtNDAtNDB6bTAgMCIvPjwvc3ZnPg==",13,13),e.expandedImage=new mxImage("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/PjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQyIDQyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0MiA0MjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGQ9Ik0zNy4wNTksMTZIMjZIMTZINC45NDFDMi4yMjQsMTYsMCwxOC4yODIsMCwyMXMyLjIyNCw1LDQuOTQxLDVIMTZoMTBoMTEuMDU5QzM5Ljc3NiwyNiw0MiwyMy43MTgsNDIsMjEgUzM5Ljc3NiwxNiwzNy4wNTksMTZ6Ii8+PC9zdmc+",13,13),e.foldItems=function(e=!0){let t;t=this.getSelectionCells().length>0?this.getSelectionCells():this.getDefaultParent().children;for(let n=0;n<t.length;n++)t[n].style&&t[n].style.search("umk_group")>=0&&this.foldCells(e,!1,[t[n]])};const t=mxGraph.prototype.isValidDropTarget;e.isValidDropTarget=function(e,n,a){let s=t.apply(this,arguments);return s?!!(e.getStyle()&&e.getStyle().search("umk_group")>=0):s},mxDragSource.prototype.getDropTarget=function(e,t,n){let a=e.getCellAt(t,n);return e.isValidDropTarget(a)||(a=null),a},e.addListener(mxEvent.CELLS_RESIZED,function(t,n){let a=n.getProperty("cells");if(null!=a)for(let t=0;t<a.length;t++)if(a[t].style&&a[t].style.search("umk_group")>=0&&e.getModel().getChildCount(a[t])>0){let n=e.getCellGeometry(a[t]);if(null!=n){let s=e.getChildCells(a[t],!0,!0),r=e.getBoundingBoxFromGeometry(s,!0);n=n.clone(),a[t].collapsed?n.height=25:(n.width=Math.max(n.width,r.width+r.x+25),n.height=Math.max(n.height,r.height+r.y+25)),e.getModel().setGeometry(a[t],n)}}});var n=mxGraph.prototype.createGroupCell;mxGraph.prototype.createGroupCell=function(e){var t=n.apply(this,arguments);return t.setStyle("umk_group;"),t.setValue(GUIText[settings.lang].subModel),t}})(mainSystem.graph);const uyamakCbManager={graph:new mxGraph(document.getElementById("GraphForCopyPaste")),clone:function(){mainSystem.graph.createSubModel(),mxClipboard.copy(mainSystem.graph),mainSystem.graph.ungroupSubModel(),mxClipboard.paste(mainSystem.graph),mainSystem.graph.orderCells(!1),mainSystem.graph.ungroupSubModel()},cut:function(){this.copy(),mainSystem.graph.isEnabled()&&mainSystem.graph.removeCells()},copy:function(){this.graph.getModel().clear(),mainSystem.graph.createSubModel(),mxClipboard.copy(mainSystem.graph),mxClipboard.paste(this.graph),mxClipboard.insertCount--,this.graph.ungroupSubModel(),this.presPasteText=uyamakFileManager.compressModel(this.graph),navigator.clipboard.writeText(this.presPasteText).then(e=>{console.log("Copied")}),mainSystem.graph.ungroupSubModel()},presPasteText:"",paste:function(){navigator.clipboard.readText().then(e=>{try{this.presPasteText!==e&&(this.presPasteText=e,mxClipboard.setCells([]),this.prepareAltAndCopy(e)),this.bringModelToMain()}catch(e){console.log(e),console.log("unable to paste"),new Noty({text:GUIText[settings.lang].errorGen,timeout:5e3,theme:"nest",type:"error"}).show()}})},bringModelToMain:function(){mainSystem.graph.getModel().beginUpdate(),mxClipboard.paste(mainSystem.graph),mainSystem.graph.orderCells(!1),mainSystem.graph.getModel().endUpdate(),mainSystem.graph.ungroupSubModel(),mainSystem.refresh()},prepareAltAndCopy:function(e,t=!0){this.inmportToGraph(e,this.graph,t),this.graph.setSelectionCells(this.graph.getChildCells()),this.graph.createSubModel(),mxClipboard.copy(this.graph),this.graph.ungroupSubModel()},inmportToGraph:function(e,t,n=!0){let a;if(n){let t=new Uint16Array(uyamakFileManager.str2ab(e));t=uyamakFileManager.escZero(t,!1);let n=pako.inflate(t);a=uyamakFileManager.ab2str(n)}else a=e;let s=mxUtils.parseXml(a),r=new mxCodec(s);r.decode(s.documentElement,t.getModel())},linkToParentCells(e,t){let n={};for(let a=0;a<t.length;a++)for(let s=0;s<e.length;s++)n[a]=t[a],t[a].id===e[s].id&&(n[a]=e[s]);return n}};mxClipboard.copy=function(e,t){t=t||e.getSelectionCells();let n=e.getExportableCells(t);mxClipboard.parents=new Object;for(let a=0;a<n.length;a++)mxClipboard.parents[a]=e.model.getParent(t[a]);return mxClipboard.insertCount=1,mxClipboard.setCells(e.cloneCells(n)),n},mxClipboard.paste=function(e){if(!mxClipboard.isEmpty()){let t=e.getImportableCells(mxClipboard.getCells()),n=mxClipboard.insertCount*mxClipboard.STEPSIZE,a=e.getDefaultParent();e.model.beginUpdate();try{for(let s=0;s<t.length;s++){let r=null!=mxClipboard.parents&&e.model.contains(mxClipboard.parents[s])?mxClipboard.parents[s]:a;t[s]=e.importCells([t[s]],n,n,r)[0]}}finally{e.model.endUpdate()}mxClipboard.insertCount++,e.setSelectionCells(t)}},mainSystem.graph.model.addListener(mxEvent.CHANGE,function(e,t){settings.showExeOrder&&simVue.displayExecutionOrder()}),mainSystem.graph.cellsRemoved=function(e){return e.forEach(e=>{try{popup.close(e.id),e.value.Dest()}catch(e){}}),mxGraph.prototype.cellsRemoved.apply(this,arguments)};const oldEncode=mxCodec.prototype.encode;mxCodec.prototype.encode=function(e){if(!("Object"===e.constructor.name||e.constructor.name.search(/umk_\d{13}/g)>=0)){let t=oldEncode.apply(this,arguments);return t&&t.getAttribute("style")&&t.getAttribute("style").search("umk_model")>=0&&t.setAttribute("value",JSON.stringify2(e.value)),t}},((e,t)=>{e.panningHandler.isPopupTrigger=function(){return!1},e.setEnterStopsCellEditing(!0),e.getAllConnectionConstraints=function(e){var t=null!=e?this.getCellGeometry(e.cell):null;return null!=t&&!t.relative&&this.getModel().isVertex(e.cell)&&0==this.getModel().getChildCount(e.cell)?[new mxConnectionConstraint(new mxPoint(0,.5),!1),new mxConnectionConstraint(new mxPoint(1,.5),!1)]:null},e.connectionHandler.isConnectableCell=function(e){if(this.graph.getModel().isEdge(e))return!0;var t=null!=e?this.graph.getCellGeometry(e):null;return null!=t&&t.relative},mxEdgeHandler.prototype.isConnectableCell=function(t){return e.connectionHandler.isConnectableCell(t)},e.setTooltips(!0),e.getTooltipForCell=function(e){let t=this.convertValueToString(e);return t},e.convertValueToString=function(e){if(e.style&&e.style.search("umk_model")>=0)return e.value.Name?e.value.Name:null;if(e.style&&e.style.search("umk_output")>=0){if(e.value)return e.value;{const t=e.parent.children;let n=0;for(let a=0;a<t.length&&!(t[a].style.search("umk_output")>=0&&(n++,e===t[a]));a++);return n}}if(e.style&&e.style.search("umk_input")>=0){if(e.value)return e.value;{const t=e.parent.children;let n=0;for(let a=0;a<t.length&&!(t[a].style.search("umk_input")>=0&&(n++,e===t[a]));a++);return n}}return e.value?e.value:""};var n=e.getTooltipForCell;e.getTooltipForCell=function(e){var t="";if(null!=e){var a=this.getModel().getTerminal(e,!0);null!=a&&(t+="["+this.getTooltipForCell(a)+"]&#9477;");var s=this.getModel().getParent(e);this.getModel().isVertex(s)&&(t+=this.getTooltipForCell(s)+".");const o=n.apply(this,arguments);t+=o;var r=this.getModel().getTerminal(e,!1);null!=r&&(t+=""===o?"":"&#9477;",t+="["+this.getTooltipForCell(r)+"]")}return t};var a=!1;a&&(t.style.backgroundColor="black",mxCellEditorStartEditing=mxCellEditor.prototype.startEditing,mxCellEditor.prototype.startEditing=function(e,t){mxCellEditorStartEditing.apply(this,arguments),null!=this.textarea&&(this.textarea.style.color="#FFFFFF")},mxGraphHandler.prototype.previewColor="white"),e.wMode=!1;var s=e.connectionHandler.isStartEvent;e.connectionHandler.isStartEvent=function(t){return e.wMode||s.apply(this,arguments)};var r=e.connectionHandler.mouseUp;e.connectionHandler.mouseUp=function(t,n){if(null!=this.first&&null!=this.previous){var a=mxUtils.convertPoint(this.graph.container,n.getX(),n.getY()),s=Math.abs(a.x-this.first.x),o=Math.abs(a.y-this.first.y);if(s<this.graph.tolerance&&o<this.graph.tolerance)return void(!e.wMode&&this.graph.getModel().isEdge(this.previous.cell)&&this.reset())}r.apply(this,arguments)},e.customValidationError=!0,e.getEdgeValidationError=function(t,n,a){let s=mxGraph.prototype.getEdgeValidationError.apply(this,arguments);if(!this.customValidationError)return s;{let r;try{e.areAllFromSameNode([n,a],[t])?r=GUIText[settings.lang].errSameBlkConn:e.doesContainMultipleSources([n,a],[t])&&(r=GUIText[settings.lang].errInpInpConn)}catch(e){console.log(e)}finally{return r||s}}}})(mainSystem.graph,document.getElementById("modelContainer")),(e=>{e.setPanning(!0);var t=new mxRubberband(e);e.addListener(mxEvent.TAP_AND_HOLD,function(n,a){if(!mxEvent.isMultiTouchEvent(a)){var s=a.getProperty("event"),r=a.getProperty("cell");if(null==r){var o=mxUtils.convertPoint(this.container,mxEvent.getClientX(s),mxEvent.getClientY(s));t.start(o.x,o.y)}else e.getSelectionCount()>1&&e.isCellSelected(r)&&e.removeSelectionCell(r);a.consume()}})})(mainSystem.graph),(e=>{function t(){}function n(){}mxConstants.OUTLINE_COLOR="var(--col-border-1)",mxConstants.OUTLINE_HANDLE_STROKECOLOR="var(--col-border-1)",mxConstants.OUTLINE_HANDLE_FILLCOLOR="var(--col-background-2)",mxConstants.STYLE_BACKGROUND_OUTLINE="var(--col-background-1)",mxConstants.HIGHLIGHT_COLOR="var(--col-border-1)",mxConstants.GUIDE_COLOR="var(--col-text-1)",mxConstants.HANDLE_STROKECOLOR="var(--col-border-1)",mxConstants.HANDLE_FILLCOLOR="var(--col-background-2)",mxConstants.EDGE_SELECTION_COLOR="var(--col-border-1)",mxConstants.VERTEX_SELECTION_COLOR="var(--col-border-1)",mxConstants.DROP_TARGET_COLOR="var(--col-border-1)",mxConstants.STYLE_FONTFAMILY="Univers 57 Condensed",mxConstants.DEFAULT_FONTFAMILY="Univers 57 Condensed",mxConstants.DEFAULT_FONTSIZE="15",mxConstants.SHADOWCOLOR="var(--col-text-0 )",mxConstants.SHADOW_OFFSET_X=3,mxConstants.SHADOW_OFFSET_Y=3,mxConstants.SHADOW_OPACITY=.15,e.dropEnabled=!0,e.setRecursiveResize(!1),mxGraphHandler.prototype.guidesEnabled=!0,mxGuide.prototype.isEnabledForEvent=function(e){return!mxEvent.isAltDown(e)},mxEdgeHandler.prototype.snapToTerminals=!0,e.constrainChildren=!1,e.htmlLabels=!0;const a=e.getStylesheet().getDefaultVertexStyle(),s=e.getStylesheet().getDefaultEdgeStyle();a.shadow=!1,a.whiteSpace="wrap",a.arcSize=10,a.absoluteArcSize=1,a.rounded="1",a.strokeWidth=0,s.edgeStyle="wireEdgeStyle",s.strokeWidth=1,s.movable="0",s[mxConstants.STYLE_JETTY_SIZE]=50,s.shadow=!1,s.fontColor="var(--col-text-0)",s.verticalAlign="top",s.align="right",s.strokeColor="var(--col-text-0)",s.startSize=7,s.endSize=7,delete s.endArrow,t.prototype=new mxCylinder,t.prototype.constructor=t,t.prototype.redrawPath=function(e,t,n,a,s,r){r&&(e.moveTo(a/2,s/2),e.lineTo(a,s/2),e.moveTo(3*a/4,s),e.lineTo(a,s/2),e.lineTo(3*a/4,0),e.end())},mxCellRenderer.registerShape("inArrow",t),n.prototype=new mxCylinder,n.prototype.constructor=n,n.prototype.redrawPath=function(e,t,n,a,s,r){r&&(e.moveTo(0,s/2),e.lineTo(a/2,s/2),e.end())},mxCellRenderer.registerShape("outArrow",n);let r=new Object;r.foldable=0,r.overflow="hidden",
r.verticalAlign="middle",r.fontColor="var(--col-text-1)",r.fillColor="var(--col-background-2)",r.strokeColor="var(--col-text-0)",r.shadow=0,e.getStylesheet().putCellStyle("umk_model",r),r=new Object,r[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_SWIMLANE,r.startSize=25,r.strokeWidth=1,r.arcSize=0,r.foldable=1,r.strokeColor="var(--col-border-0)",r.fontColor="var(--col-text-0)",r.verticalAlign="top",r.fillColor="var(--col-background-1)",r.resizable=1,e.getStylesheet().putCellStyle("umk_group",r),r=new Object,r.constituent=1,r.labelPosition="center",r.verticalLabelPosition="bottom",r.verticalAlign="top",r.fontColor="var(--col-text-0)",e.getStylesheet().putCellStyle("umk_caption_0",r),r=new Object,r.constituent=1,r.labelPosition="left",r.verticalLabelPosition="bottom",r.verticalAlign="top",r.fontColor="var(--col-text-0)",r.rotation=270,e.getStylesheet().putCellStyle("umk_caption_90",r),r=new Object,r.constituent=1,r.labelPosition="center",r.verticalLabelPosition="bottom",r.verticalAlign="top",r.fontColor="var(--col-text-0)",e.getStylesheet().putCellStyle("umk_caption_180",r),r=new Object,r.constituent=1,r.labelPosition="right",r.verticalLabelPosition="bottom",r.verticalAlign="top",r.fontColor="var(--col-text-0)",r.rotation=270,e.getStylesheet().putCellStyle("umk_caption_270",r),r=new Object,r.constituent=1,r.align="center",r.verticalAlign="bottom",r.fontColor="var(--col-text-0)",e.getStylesheet().putCellStyle("umk_EO_0",r),r=new Object,r.constituent=1,r.align="center",r.verticalAlign="bottom",r.fontColor="var(--col-text-0)",r.rotation=270,e.getStylesheet().putCellStyle("umk_EO_90",r),r=new Object,r.constituent=1,r.align="center",r.verticalAlign="bottom",r.fontColor="var(--col-text-0)",e.getStylesheet().putCellStyle("umk_EO_180",r),r=new Object,r.constituent=1,r.align="center",r.verticalAlign="bottom",r.fontColor="var(--col-text-0)",r.rotation=270,e.getStylesheet().putCellStyle("umk_EO_270",r),r=new Object,r.constituent=1,r.verticalAlign="middle",r.fontColor="var(--col-text-0)",r.labelPosition="right",r.labelWidth=15,r.align="left",r.shape="inArrow",r.strokeWidth=1,r.portConstraint="west",r.overflow="fit",r.fillColor="var(--col-text-0)",r.strokeColor="var(--col-text-0)",r.fontSize=12,r.spacingLeft=0,r.rounded=0,e.getStylesheet().putCellStyle("umk_input",r),r=new Object,r.constituent=1,r.verticalAlign="middle",r.fontColor="var(--col-text-0)",r.labelPosition="left",r.labelWidth=12,r.align="right",r.shape="outArrow",r.portConstraint="east",r.overflow="fit",r.fillColor="var(--col-text-0)",r.strokeColor="var(--col-text-0)",r.spacingLeft=12,r.strokeWidth=1,e.getStylesheet().putCellStyle("umk_output",r)})(mainSystem.graph),mainSystem.graph.addListener(mxEvent.ADD_CELLS,function(e,t,n,a,s,r,o){}),(graph=>{graph.hideGraphText=!1,graph.getLabel=function(cell){if(!cell.value)return null;if(!(cell.style&&cell.style.search("umk_model")>=0))return cell.style&&cell.style.search("umk_EO")>=0&&!this.showExeOrder?"":cell.value;if(this.hideGraphText)return"";try{return("string"==typeof cell.value||"Object"==typeof cell.value&&cell.value.constructor.name.search(/umk_\d{13}/g)>=0)&&("Object"!=typeof cell.value&&(cell.value=JSON.parse2(cell.value)),eval("var tempModel = new "+cell.value.id+"(cell.value);"),cell.value=tempModel),this.setCaption(cell,cell.value.Name),cell.style&&cell.style.search("umk_display")>=0?cell.value.show||"$[\\cdot]$":"<div class='rotate-"+cell.value.rotateHTML+"'>"+cell.value.Icon().html+"</div>"}catch(e){return console.log(e),"ERROR"}},graph.getEditingValue=function(e,t){return e.value?"object"==typeof e.value?e.value.Name||"":e.value:null},graph.labelChanged=function(e,t,n){if(e.value&&"object"==typeof e.value){let n=mxUtils.clone(e.value);n.Name=t,t=n}mxGraph.prototype.labelChanged.apply(this,arguments)},graph.showCaptions=!0,graph.showExeOrder=!0,graph.setCaption=function(e,t){let n=e.children;if(n)for(let e=0;e<n.length;e++)n[e].style&&n[e].style.search("umk_caption")>=0&&(this.showCaptions?n[e].setValue(t):n[e].setValue(""))}})(mainSystem.graph),(e=>{e.undoManager=new mxUndoManager;const t=function(t,n){e.undoManager.undoableEditHappened(n.getProperty("edit"))};e.graph.getModel().addListener(mxEvent.UNDO,t),e.graph.getView().addListener(mxEvent.UNDO,t)})(mainSystem),(e=>{const t=document.createElement("canvas");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=-1,e.container.appendChild(t),e.gridCanvas=t,e.grid={canvas:t,sGraph:e,minorStroke:{color:"#808080",thickness:.1,pattern:"",show:!1},majorStroke:{color:"#808080",thickness:.5,pattern:"2, 2",show:!0},megaStroke:{color:"#808080",thickness:1,pattern:"20, 5, 5, 5",show:!1},repaintGrid:function(){let e=this.sGraph,t=window.getComputedStyle(e.container,null).getPropertyValue("border-color");this.minorStroke.color=t,this.majorStroke.color=t,this.megaStroke.color=t;let n=0,a=0,s=new mxPoint,r=0,o=0,i=this.canvas.getContext("2d");if(i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="#ff000000",i.fillRect(0,0,this.canvas.width,this.canvas.height),null!=i){let t=e.getGraphBounds(),l=Math.max(t.x+t.width,e.container.clientWidth),c=Math.max(t.y+t.height,e.container.clientHeight),u=l!=r||c!=o;if(e.view.scale!=n||e.view.translate.x!=s.x||e.view.translate.y!=s.y||a!=e.gridSize||u){s=e.view.translate.clone(),n=e.view.scale,a=e.gridSize,r=l,o=c,u?(this.canvas.setAttribute("width",r),this.canvas.setAttribute("height",o)):i.clearRect(0,0,r,o);let t=s.x*n,m=s.y*n,h=e.gridSize,d=h*n,p=Math.floor((0-t)/d)*d+t,g=Math.ceil(r/d)*d,y=Math.floor((0-m)/d)*d+m,f=Math.ceil(o/d)*d;g+=Math.ceil(d),f+=Math.ceil(d);let k=Math.round(p),x=Math.round(g),S=Math.round(y),b=Math.round(f);if(this.minorStroke.show){i.strokeStyle=this.minorStroke.color,i.beginPath(),i.lineCap="round";try{i.setLineDash(JSON.parse("["+this.minorStroke.pattern+"]"))}catch(e){}i.lineWidth=this.minorStroke.thickness;for(let e=p;e<=g;e+=d){e=Math.round((e-t)/d)*d+t;let n=Math.round(e);i.moveTo(n+.5,S+.5),i.lineTo(n+.5,b+.5)}for(let e=y;e<=f;e+=d){e=Math.round((e-m)/d)*d+m;let t=Math.round(e);i.moveTo(k+.5,t+.5),i.lineTo(x+.5,t+.5)}i.closePath(),i.stroke()}if(d*=5,this.majorStroke.show){i.strokeStyle=this.majorStroke.color,p=Math.floor((0-t)/d)*d+t,g=Math.ceil(r/d)*d,y=Math.floor((0-m)/d)*d+m,f=Math.ceil(o/d)*d,g+=Math.ceil(d),f+=Math.ceil(d),k=Math.round(p),x=Math.round(g),S=Math.round(y),b=Math.round(f),i.beginPath(),i.lineCap="round";try{i.setLineDash(JSON.parse("["+this.majorStroke.pattern+"]"))}catch(e){}i.lineWidth=this.majorStroke.thickness;for(let e=p;e<=g;e+=d){e=Math.round((e-t)/d)*d+t;let n=Math.round(e);i.moveTo(n+.5,S+.5),i.lineTo(n+.5,b+.5)}for(let e=y;e<=f;e+=d){e=Math.round((e-m)/d)*d+m;let t=Math.round(e);i.moveTo(k+.5,t+.5),i.lineTo(x+.5,t+.5)}i.closePath(),i.stroke()}if(d*=2,this.megaStroke.show){i.strokeStyle=this.megaStroke.color,p=Math.floor((0-t)/d)*d+t,g=Math.ceil(r/d)*d,y=Math.floor((0-m)/d)*d+m,f=Math.ceil(o/d)*d,g+=Math.ceil(d),f+=Math.ceil(d),k=Math.round(p),x=Math.round(g),S=Math.round(y),b=Math.round(f),i.beginPath(),i.lineCap="round";try{i.setLineDash(JSON.parse("["+this.megaStroke.pattern+"]"))}catch(e){}i.lineWidth=this.megaStroke.thickness;for(let e=p;e<=g;e+=d){e=Math.round((e-t)/d)*d+t;let n=Math.round(e);i.moveTo(n+.5,S+.5),i.lineTo(n+.5,b+.5)}for(let e=y;e<=f;e+=d){e=Math.round((e-m)/d)*d+m;let t=Math.round(e);i.moveTo(k+.5,t+.5),i.lineTo(x+.5,t+.5)}i.closePath(),i.stroke()}}}}}})(mainSystem.graph),((e,t,n)=>{n.visibility=!1,n.setVisiblity=function(){n.container.style.display=n.visibility?"block":"none"},n.update=function(e){return mainSystem.graph.grid.repaintGrid(),mxOutline.prototype.update.apply(this,arguments)},n.mouseDown=function(e,t){return mainSystem.graph.gridCanvas.style.display="none",mxOutline.prototype.mouseDown.apply(this,arguments)},n.mouseUp=function(e,t){return mainSystem.graph.gridCanvas.style.display="block",mxOutline.prototype.mouseUp.apply(this,arguments)},t.refresh=function(e){let t=mxGraph.prototype.refresh.apply(this,arguments);return mathEqn.update(),t},e.isRefreshing=!1,e.refreshNow=function(e){try{e.graph.refresh(),e.outline.visibility?e.graph.container.style.overflow="hidden":e.graph.container.style.overflow="auto",e.outline.setVisiblity(),e.outline.refresh()}catch(e){console.log(e)}e.isRefreshing=!1},e.refresh=function(){e.isRefreshing||(e.isRefreshing=!0,setTimeout(e.refreshNow.bind(null,e),300))}})(mainSystem,mainSystem.graph,mainSystem.outline),(graph=>{function selectionChanged(){clearAllTheGraphSelections(),1===mainSystem.graph.getSelectionCells().length&&mainSystem.graph.getSelectionCell()&&mainSystem.graph.getSelectionCell().isVertex()&&"object"==typeof mainSystem.graph.getSelectionCell().value?changeEditModelWithSelectedBlock():1===mainSystem.graph.getSelectionCells().length&&mainSystem.graph.getSelectionCell()&&mainSystem.graph.getSelectionCell().isEdge()?editorVue.$set(editorVue.$data,"modelValue",mainSystem.graph.getSelectionCell().value):1===mainSystem.graph.getSelectionCells().length&&mainSystem.graph.getSelectionCell()&&mainSystem.graph.getSelectionCell().style&&mainSystem.graph.getSelectionCell().style.search("umk_group")>=0&&editorVue.$set(editorVue.$data,"modelValue",mainSystem.graph.getSelectionCell().value)}function changeEditModelWithSelectedBlock(){eval("var editModel = new "+mainSystem.graph.getSelectionCell().value.id+"(mainSystem.graph.getSelectionCell().value);"),editorVue.$set(editorVue.$data,"uyamakModel",editModel),editorVue.$set(editorVue.$data,"parametersDisplay",{})}function clearAllTheGraphSelections(){editorVue.$set(editorVue.$data,"uyamakModel",null),editorVue.$set(editorVue.$data,"modelValue",null),editorVue.$set(editorVue.$data,"bunchOfItems",null)}graph.selectCellForEvent=function(e){graph.isPart(e)&&(e=graph.model.getParent(e)),mxGraph.prototype.selectCellForEvent.apply(this,arguments)},graph.isPart=function(e){let t=graph.getCellStyle(e);return"1"==t.constituent},graph.isCellSelectable=function(e){let t=this.view.getState(e),n=null!=t?t.style:this.getCellStyle(e);return this.isCellsSelectable()&&!this.isCellLocked(e)&&0!=n.selectable},graph.getSelectionModel().addListener(mxEvent.CHANGE,function(e,t){selectionChanged()})})(mainSystem.graph),((e,t)=>{t.navigate={sGraph:t,move:function(e="up",t=10){let n,a=this.sGraph;t/=a.view.scale;let s=a.getSelectionCells();switch(s.length&&"0"!==e?(n={},n.x=0,n.y=0):n=a.view.getTranslate(),e){case"up":n.y+=t;break;case"down":n.y-=t;break;case"left":n.x+=t;break;case"right":n.x-=t;break;case"0":n.x=0,n.y=0}s.length?a.moveCells(s,-n.x,-n.y):a.view.setTranslate(n.x,n.y),a.view.refresh()}},e.navigate=function(e="up"){switch(e){case"up":case"down":case"left":case"right":case"0":this.graph.navigate.move(e);break;case"zoomIn":this.graph.zoomIn();break;case"zoomOut":this.graph.zoomOut();break;case"zoomActual":this.graph.zoomActual();break;case"fit":this.graph.fit()}this.refresh()}})(mainSystem,mainSystem.graph);const mathEqn={updInProgress:updInProgress=!1,updNow:updNow=function(){MathJax.typesetPromise(),this.updInProgress=!1},update:function(){this.updInProgress||(this.updInProgress=!0,setTimeout(function(){mathEqn.updNow()},50))}},TeX={avoidItems:[{js:"Infinity",tex:"\\infty"}],removeAvoidedItems:function(e){outString=e;for(let e=0;e<this.avoidItems.length;e++)outString=outString.replace(this.avoidItems[e].js,this.avoidItems[e].tex);return outString},frmStr:function(e,t=4){return math.parse(e).toTex(t)},frmMathJS:function(e,t=4){return math.parse(e.toString()).toTex(t)},frmArray:function(e,t=4,n=!1){return n||1!==e.length||1!==e[0].length?math.parse("["+e.map(e=>"["+e.join(",")+"]").join(",")+"]").toTex(t):math.parse(e[0][0]).toTex()},getTeXDisp:function(e,t=4){return"$"+this.getTeXInline(e,t)+"$"},getTeXInline:function(e,t=4){return"$"+this.makeMatrix(e,t)+"$"},prepInline:function(e){return"$"+e+"$"},prepDisp:function(e){return"$$"+e+"$$"},prepSetWithRange:function(e=1,t=1){if(t<e){let n=t;t=e,e=n}if(e===t)return"\\{"+e+"\\}";if(e===-1/0&&t===1/0)return"\\{-\\infty,\\dots, -1, 0, 1,\\dots,\\infty\\}";if(e===-1/0)return"\\{-\\infty,\\dots,"+(t-2)+","+(t-1)+","+t+"\\}";if(t===1/0)return"\\{"+e+","+(e-1)+","+(e-2)+"\\dots,\\infty\\}";let n=t-e,a="\\{";if(n<5){let n=!0;for(let s=e;s<t+1;s++)n?n=!1:a+=",",a+=s;return a+"\\}"}{let n=t+"\\}",a="\\{"+e+",";if(t>3)n="\\dots,"+n,e<=0?(n="0,1,"+n,e<-3?a+="\\dots,-1,":(e<-2&&(a+="-2,"),e<-1&&(a+="-1,"))):a+=e+1+","+(e+2)+",";else if(e<-3)a+="\\dots,-1,",t>2&&(n="2,"+n),t>1&&(n="1,"+n),t>0&&(n="0,"+n);else for(let n=e+1;n<t;n++)a+=n+",";return a+n}}},blocksVue=new Vue({el:"#lp-content",data:{updateCounter:0,statusVisible:0,searchText:"",categories:bSummary.categories,blksSummary:bSummary.blocks,blksPerCategories:bSummary.getBlocksForCategories(),disp:{search:!0},iconText:{icon1:"<svg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'><g><rect rx='10' height='100' width='100' fill-opacity='0.15' fill='",icon2:"'/></g><g stroke-linecap='round' width='100' height='100' stroke='",icon3:"' stroke-width='10' fill='none'>",icon4:"</g></svg>"}},updated:function(){let e=document.getElementsByClassName("libraryBlock");for(let t=0;t<e.length;t++)new blockOnDOM(e[t])},computed:{searchResults:function(){let e=[];for(let t=0;t<Object.keys(this.blksSummary).length;t++){let n=Object.keys(this.blksSummary)[t],a=JSON.stringify(Object.values(this.blksSummary[n].name))+JSON.stringify(Object.values(this.blksSummary[n].desc))+this.blksSummary[n].keywords;a.toLocaleLowerCase().indexOf(this.searchText.toLocaleLowerCase())>0&&e.push(n)}return e}},mounted:function(){this.disp[bSummary.getCategoriesIdList()[0]]=!0,this.updateCounter++},methods:{focusBar:function(){document.getElementById("search-input").focus()},showStatus:function(e){this.statusVisible&&this.removeStatus(this.statusVisible),this.statusVisible=footerVue.addHint("<span><i class='fas fa-fw fa-puzzle-piece'></i>&nbsp;"+e.name[settings.lang]+"&nbsp;&mdash;&nbsp;"+e.desc[settings.lang]+"</span>")},removeStatus:function(){footerVue.removeHint(this.statusVisible),this.statusVisible=0},sBFocus:function(e=!0){kbshort.suspend(e,function(e){27===e.keyCode&&blocksVue.$set(blocksVue.$data,"searchText","")})},getBlockImage:function(e){return"data:image/svg+xml;base64,"+window.btoa(this.iconText.icon1+e.bg+this.iconText.icon2+e.bg+this.iconText.icon3+e.icon+this.iconText.icon4)}}}),kbshortcut=function(menuItem){function registerANewKBS(e,t){if(e.keycode){let n="";e.ctrl&&(n+="CTRL_"),e.alt&&(n+="ALT_"),e.shift&&(n+="SHIFT_"),n+=e.keycode,kbsRegistered[n]=t}}let suspendShortcuts=!0,callback=null;const kbsRegistered={},extraKBShortcut=[{ctrl:!0,alt:!1,shift:!1,keycode:"96",func:"mainSystem.navigate('zoomActual')"},{ctrl:!0,alt:!1,shift:!0,keycode:"96",func:"mainSystem.navigate('fit')"},{ctrl:!0,alt:!1,shift:!1,keycode:"189",func:"mainSystem.navigate('zoomOut')"},{ctrl:!0,alt:!1,shift:!1,keycode:"187",func:"mainSystem.navigate('zoomIn')"},{ctrl:!1,alt:!1,shift:!1,keycode:"38",func:"mainSystem.navigate('up')"},{ctrl:!1,alt:!1,shift:!1,keycode:"40",func:"mainSystem.navigate('down')"},{ctrl:!1,alt:!1,shift:!1,keycode:"39",func:"mainSystem.navigate('right')"},{ctrl:!1,alt:!1,shift:!1,keycode:"37",func:"mainSystem.navigate('left')"}];menuItem.forEach(e=>{e.subMenu.forEach(e=>{registerANewKBS(e.kbShort,e.func)})}),extraKBShortcut.forEach(e=>{registerANewKBS(e,e.func)}),document.onkeydown=function(event){if(event.srcElement.className.toLowerCase().indexOf("mxCellEditor".toLowerCase())<0&&event.srcElement.tagName.toLowerCase().indexOf("input".toLowerCase())<0)if(suspendShortcuts)callback(event);else{let key="";event.ctrlKey&&(key+="CTRL_"),event.altKey&&(key+="ALT_"),event.shiftKey&&(key+="SHIFT_"),key+=event.keyCode,kbsRegistered[key]&&(event.preventDefault(),event.repeat||eval(kbsRegistered[key]))}},this.suspend=function(e=!0,t=null){suspendShortcuts=e,callback=t},mainSystem.graph.container.addEventListener("wheel",function(e){e.ctrlKey&&(e.wheelDelta>0?mainSystem.graph.zoomIn():mainSystem.graph.zoomOut(),e.preventDefault())}),document.addEventListener("contextmenu",e=>e.preventDefault())};kbshort=new kbshortcut(menu);const editorVue=new Vue({el:"#rp-content",data:{rpSettings:Object.assign({hideGraphText:!1,fEditMode:!0},settings),uyamakModel:null,modelValue:null,bunchOfItems:!1,parametersDisplay:null,updatingCounter:0},computed:{getBlockDetails:function(){try{return this.uyamakModel.Details()}catch(e){return console.log(e),GUIText[settings.lang].errDetails}},isBlockValid:function(){try{return!this.uyamakModel.invalidParams()}catch(e){return void console.log(e)}}},mounted:function(){this.refreshGraph()},updated:function(){mathEqn.update()},watch:{rpSettings:{deep:!0,handler:function(e){(!e.gridSize||e.gridSize<=0)&&(e.gridSize=1),settingsVue.$set(settingsVue.$data.stings,"gLinesMinor",e.gLinesMinor),settingsVue.$set(settingsVue.$data.stings,"gLinesMajor",e.gLinesMajor),settingsVue.$set(settingsVue.$data.stings,"gLinesMega",e.gLinesMega),settingsVue.$set(settingsVue.$data.stings,"showOutline",e.showOutline),settingsVue.$set(settingsVue.$data.stings,"gridSize",e.gridSize),settingsVue.$set(settingsVue.$data.stings,"guidesEnabled",e.guidesEnabled),settingsVue.$set(settingsVue.$data.stings,"showLabels",e.showLabels),settingsVue.$set(settingsVue.$data.stings,"showExeOrder",e.showExeOrder),settingsVue.$set(settingsVue.$data.stings,"snapToGrid",e.snapToGrid),mainSystem.graph.hideGraphText=editorVue.rpSettings.hideGraphText,this.refreshGraph()}}},methods:{refreshGraph(){mainSystem.graph.grid.minorStroke.show=this.rpSettings.fEditMode&&this.rpSettings.gLinesMinor,mainSystem.graph.grid.majorStroke.show=this.rpSettings.fEditMode&&this.rpSettings.gLinesMajor,mainSystem.graph.grid.megaStroke.show=this.rpSettings.fEditMode&&this.rpSettings.gLinesMega,mainSystem.outline.visibility=this.rpSettings.showOutline,mainSystem.graph.graphHandler.guidesEnabled=this.rpSettings.guidesEnabled,mainSystem.graph.gridSize=this.rpSettings.gridSize,mainSystem.graph.showCaptions=this.rpSettings.showLabels,mainSystem.graph.showExeOrder=this.rpSettings.showExeOrder,mainSystem.graph.gridEnabled=this.rpSettings.snapToGrid,mainSystem.refresh()},rotateAll:function(e=!0){let t=mainSystem.graph.getSelectionCells();for(let n=0;n<t.length;n++)if(t[n]&&t[n].style&&t[n].style.search("umk_model")>=0){let a=this.getAngle(t[n]);e?(a+=90,a%=360):(a-=90,a<0&&(a+=360)),this.rotate(a,t[n],!1)}},getAngle:function(e=null){null===e&&(e=mainSystem.graph.getSelectionCell());for(let t=0;t<e.children.length;t++)if(e.children[t].style&&e.children[t].style.search("umk_caption")>=0){let n=e.children[t].style.split("_");try{return parseInt(n[n.length-1])}catch(e){return 0}}},rotate:function(e,t=null,n=!0){null===t&&(t=mainSystem.graph.getSelectionCell());let a=mainSystem.graph.getModel();a.beginUpdate();try{t.value.rotateHTML=180===e||90===e?180:0;const s=[];s[0]={in:"west",out:"east"},s[90]={in:"north",out:"south"},s[180]={in:"east",out:"west"},s[270]={in:"south",out:"north"};const r=[];r[0]={umk_caption:{x:.5,y:1},umk_EO:{x:.5,y:0}},r[90]={umk_caption:{x:.5,y:0},umk_EO:{x:.5,y:1}},r[180]={umk_caption:{x:.5,y:0},umk_EO:{x:.5,y:1}},r[270]={umk_caption:{x:.5,y:1},umk_EO:{x:.5,y:0}},mainSystem.graph.setCellStyles("rotation",e,[t].concat(t.children));for(let n=0;n<t.children.length;n++)if(t.children[n].style)if(t.children[n].style.search("umk_input")>=0)mainSystem.graph.setCellStyles("portConstraint",s[e].in,[t.children[n]]);else if(t.children[n].style.search("umk_output")>=0)mainSystem.graph.setCellStyles("portConstraint",s[e].out,[t.children[n]]);else if(t.children[n].style.search("umk_caption")>=0){t.children[n].setStyle("umk_caption_"+e);let a=new mxGeometry(r[e].umk_caption.x,r[e].umk_caption.y,0,0);a.relative=!0,t.children[n].setGeometry(a)}else if(t.children[n].style.search("umk_EO")>=0){t.children[n].setStyle("umk_EO_"+e);let a=new mxGeometry(r[e].umk_EO.x,r[e].umk_EO.y,0,0);a.relative=!0,t.children[n].setGeometry(a)}}catch(e){console.log(e)}finally{a.endUpdate(),mainSystem.undoManager.history.pop(),mainSystem.undoManager.indexOfNextAdd--,n&&mainSystem.refresh()}},applyModelValue:function(e=null){null===e&&(e=mainSystem.graph.getSelectionCell()),e.value=this.modelValue,mainSystem.refresh()},saveModel:function(cell=null){null===cell&&(cell=mainSystem.graph.getSelectionCell()),mainSystem.graph.getModel().beginUpdate();try{eval("var tempModel = new "+this.uyamakModel.id+"(this.uyamakModel);"),cell.setValue(tempModel),setTermianls(mainSystem.graph,cell,"umk_input"),setTermianls(mainSystem.graph,cell,"umk_output")}catch(e){console.log(e)}mainSystem.graph.getModel().endUpdate(),mainSystem.refresh(),mainSystem.undoManager.history.pop(),mainSystem.undoManager.indexOfNextAdd--,this.rotate(this.getAngle()),varManagerVue.checkCellParams(cell),"mDesign"!==simVue.mode&&simVue.informSim("updateCell",cell.id),mainSystem.graph.setSelectionCells([])},toggleParamDisplay:function(e){this.updatingCounter++,this.parametersDisplay[e]=!this.parametersDisplay[e]},valueDimensionsModify:function(e,t){let n;switch(this.uyamakModel.Parameters[t].Type){case"Integer":case"Real":case"Complex":n=0;break;case"Text":n="";break;case"Color":n="#000";break;case"Options":n=Object.keys(this.uyamakModel.Parameters[t].Options)[0];break;case"Checkbox":n=!1}switch(e){case 0:this.uyamakModel.Parameters[t].Value.push(new Array(this.uyamakModel.Parameters[t].Value[0].length).fill(n));break;case 1:this.uyamakModel.Parameters[t].Value.length>1&&this.uyamakModel.Parameters[t].Value.pop();break;case 2:this.uyamakModel.Parameters[t].Value.map(function(e){return e.push(n)});break;case 3:this.uyamakModel.Parameters[t].Value[0].length>1&&this.uyamakModel.Parameters[t].Value.map(function(e){return e.pop()})}this.updatingCounter++},getComputedValueText:function(e){try{return"<br/>"+math.parse(varManagerVue.getVarValue(e.Value).toString()).toTex(4)}catch(e){return console.log(e),'<i class="fas fa-exclamation-triangle fa-fw"></i><span>'+GUIText[settings.lang].k172+"</span>"}},toggleParamCheckVal:function(e,t,n){this.uyamakModel.Parameters[e].Value[t][n]=!this.uyamakModel.Parameters[e].Value[t][n],this.updatingCounter++}}}),varManagerVue=new Vue({el:"#varManager",data:{constants:["e","E","i","Infinity","LN2","LN10","LOG2E","LOG10E","phi","pi","PI","SQRT1_2","SQRT2","tau"],keywords:["NaN","null","undefined","mod","to","in","and","xor","or","not","end"],display:!1,variables:[],varValidValues:[],showEdtVar:!1,edtVar:{name:"",value:[[1]],index:-1},parser:null},updated:function(){mathEqn.update()},watch:{display:function(){kbshort.suspend(this.display,function(e){27===e.keyCode&&varManagerVue.showGUI(!1)})}},methods:{cngVarDim:function(e){let t=this.edtVar.value;switch(e){case 0:t.push(new Array(t[0].length).fill(0));break;case 1:t.length>1&&t.pop();break;case 2:t=t.map(e=>{e.push(0)});break;case 3:t[0].length>1&&(t=t.map(e=>{e.pop()}))}},addVar:function(){let e="x",t=-1;for(;!(this.variables.findIndex(function(n){return n.name===e+(t>=0?t:"")})<0);)t++;this.edtVar={name:e+(t>=0?t:""),value:[[1]],index:-1},this.showEdtVar=!0},saveVar:function(){let e={value:JSON.parse2(JSON.stringify2(this.edtVar.value)),name:this.edtVar.name},t=this.checkValidVar(this.edtVar.name,this.edtVar.index);t.vld?(this.edtVar.index<0&&this.variables.push(e),this.edtVar.index>=0&&this.edtVar.index<this.variables.length&&(this.variables[this.edtVar.index]=e),this.showEdtVar=!1):new Noty({text:t.msg,timeout:5e3,theme:"nest",type:"error"}).show(),this.clearAndparseAll()},checkValidVar:function(e,t=-1){return isNaN(parseInt(e.charAt(0)))?e?this.keywords.indexOf(e)>=0?{vld:!1,msg:"Error: this is a keyword"}:this.constants.indexOf(e)>=0?{vld:!1,msg:"Error: this is a constant"}:this.variables.findIndex(function(n,a){return a!==t&&n.name===e})>=0?{vld:!1,msg:"Error: this variable name is already in use"}:{vld:!0,msg:""}:{vld:!1,msg:"Error: name cannot be empty"}:{vld:!1,msg:"Error: name cannot start with a number"}},showGUI:function(e=!0){this.display=e,e||(this.showEdtVar=!1,this.clearAndparseAll(),this.checkAllCellsParams())},moveVar:function(e=!0,t=0){if(t>=0&&t<this.variables.length){let n=e?t-1:t+1;n>=0&&n<this.variables.length&&this.variables.splice(n,0,this.variables.splice(t,1)[0]),this.clearAndparseAll()}},editVar:function(e){e>=0&&e<this.variables.length&&(this.edtVar={index:e,name:this.variables[e].name,value:JSON.parse(JSON.stringify(this.variables[e].value))},this.showEdtVar=!0)},delVar:function(e){this.variables.splice(e,1),this.clearAndparseAll()},getVariable:function(e){return TeX.frmArray(e.value)},clearAndparseAll:function(){this.startParser(),this.processAllVars()},startParser:function(){try{this.parser=math.parser()}catch(e){console.log(e)}},processAllVars:function(){for(let e=0;e<this.variables.length;e++){let t=this.processVar(this.variables[e]);this.varValidValues[e]=t?math.parse(t.toString()).toTex(4):"\\bigotimes"}},processVar:function(e){try{let t=this.getVarValue(e.value);return this.parser.evaluate(e.name+"="+t.toString())}catch(e){return console.log(e),!1}},isValidMathNum:function(e){return!!(math.isNumeric(e)||math.isMatrix(e)||math.isComplex(e))},getVarValue:function(e){let t,n;this.parser||this.clearAndparseAll();for(let a=0;a<e.length;a++){for(let t=0;t<e[0].length;t++){let s=this.parser.evaluate(String(e[a][t]));if(!this.isValidMathNum(s))throw"Found a math item but not a number.";math.isMatrix(s)||(s=math.matrix([[s]])),n=0===t?s:math.concat(n,s)}t=0===a?n:math.transpose(math.concat(math.transpose(t),math.transpose(n)))}return t},getConst:function(e){return"Infinity"===e?"\\infty":"number"===math.typeOf(math.evaluate(e))?math.evaluate(e):e},checkAllCellsParams:function(e=null){e||(e=Object.values(mainSystem.graph.getModel().cells));let t=!0;for(let n=0;n<e.length;n++)e[n].style&&e[n].style.indexOf("umk_model")>=0&&(this.checkCellParams(e[n])||(t=!1));return t},checkCellParams:function(e){if(this.parser||this.clearAndparseAll(),e.value.Parameters){let t=Object.keys(e.value.Parameters);for(let n=0;n<t.length;n++)if("Complex"===e.value.Parameters[t[n]].Type||"Real"===e.value.Parameters[t[n]].Type||"Integer"===e.value.Parameters[t[n]].Type){let a=e.value.Parameters[t[n]].Value;try{this.getVarValue(a)}catch(t){return console.log(t),mainSystem.graph.setCellWarning(e,"<b>"+GUIText[settings.lang].errParamEntry+"</b><br/>"+GUIText[settings.lang].errorParsing),!1}}return mainSystem.graph.setCellWarning(e),!0}return!0},toLocal:function(){},frmLocal:function(){}}});cPolicyVue=new Vue({el:"#cookies-policy",data:{display:!1},watch:{display:function(){kbshort.suspend(this.display,function(e){})}},mounted:function(){this.checkAcceptance()},methods:{acceptBtn:function(){setCookie("cpAccepted","true"),this.checkAcceptance()},checkAcceptance:function(){"true"!==getCookie("cpAccepted")?this.display=!0:this.display=!1}}});const packer={pack:function(e){let t=this.deflated16bit(encodeURI(e));return t=this.escZero(t),this.ab2str(t)},unpack:function(e){let t=new Uint16Array(this.str2ab(e));t=this.escZero(t,!1);let n=pako.inflate(t);return decodeURI(this.ab2str(n))},deflated16bit:function(e){let t=pako.deflate(e);return new Uint16Array(t)},escZero:function(e,t=!0){return e.map(e=>e+(t?3077:-3077))},ab2str:function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},str2ab:function(e){let t=new ArrayBuffer(2*e.length),n=new Uint16Array(t);for(let t=0,a=e.length;t<a;t++)n[t]=e.charCodeAt(t);return t}};uyamak.lFManagerVue=new Vue({el:"#lFManager",data:{display:!1,sFName:null,fInput:null,oFileInfo:{name:""},reader:null,sOptions:{m:!0,v:!0,s:!0,g:!0},oOptions:{m:!0,v:!0,s:!0,g:!1},oAvail:{m:!1,v:!1,s:!1,g:!1},dDAtn:null,tempKBSus:null},mounted:function(){this.fInput=document.getElementById("file-input"),this.fInput.onchange=(e=>{uyamak.lFManagerVue.$set(uyamak.lFManagerVue.$data,"oFileInfo",e.target.files[0]),uyamak.lFManagerVue.$set(uyamak.lFManagerVue.$data.fInput,"value","")}),this.reader=new FileReader,this.reader.onload=function(e){try{uyamak.lFManagerVue.obtnAvail(e.target.result)}catch(e){new Noty({text:GUIText[settings.lang].errCrpt,timeout:5e3,theme:"nest",type:"error"}).show()}}},watch:{display:function(){kbshort.suspend(this.display,function(e){27===e.keyCode&&uyamak.lFManagerVue.showGUI(!1)})},oFileInfo:{deep:!0,handler:function(){if(this.oAvail={m:null,v:null,s:null,g:null},this.oFileInfo.size>1e7)return new Noty({text:GUIText[settings.lang].errFSize,timeout:5e3,theme:"nest",type:"error"}).show(),!1;this.reader.readAsText(this.oFileInfo)}}},computed:{enSave:function(){return!!((this.sOptions.m||this.sOptions.v||this.sOptions.s||this.sOptions.g)&&this.sFName&&GSKGenFuncs.isValidFileName(this.sFName.trim()))},enOpen:function(){return!!(this.oOptions.m&&this.oAvail.m||this.oOptions.v&&this.oAvail.v||this.oOptions.s&&this.oAvail.s||this.oOptions.g&&this.oAvail.g)},enIprt:function(){return!!(this.oOptions.m&&this.oAvail.m||this.oOptions.v&&this.oAvail.v)},oFDesc:function(){return this.oFileInfo.name?this.oFileInfo.name+"; "+math.unit(this.oFileInfo.size+"b").format(4):"&nbsp;"}},methods:{oprnOpen:function(e=!1){try{if(this.oOptions.m&&this.oAvail.m&&(e?(uyamakCbManager.prepareAltAndCopy(this.oAvail.m,!1),uyamakCbManager.bringModelToMain()):(popup.closeAll(!0),mainSystem.graph.getModel().clear(),uyamakCbManager.inmportToGraph(this.oAvail.m,mainSystem.graph,!1))),this.oOptions.v&&this.oAvail.v){e||(varManagerVue.variables=[]);let t=varManagerVue.variables.length;for(let e=0;e<this.oAvail.v.length;e++){let n=-1;for(let a=0;a<t;a++)if(this.oAvail.v[e].name===varManagerVue.variables[a].name){n=a;break}n<0?varManagerVue.variables.push(this.oAvail.v[e]):varManagerVue.variables[n]=this.oAvail.v[e]}varManagerVue.clearAndparseAll()}if(this.oOptions.s&&this.oAvail.s){let e=Object.keys(this.oAvail.s);for(let t=0;t<e.length;t++)simVue.simSettings[e[t]]=this.oAvail.s[e[t]]}if(this.oOptions.g&&this.oAvail.g){let e=Object.keys(this.oAvail.g);for(let t=0;t<e.length;t++)settings[e[t]]=this.oAvail.g[e[t]]}}catch(e){console.log(e)}this.showGUI(!1)},sToFile:function(){let e={};this.sOptions.m&&(e.m=uyamak.cmprs.xmlText()),this.sOptions.v&&(e.v=varManagerVue.variables),this.sOptions.s&&(e.s=simVue.simSettings),this.sOptions.g&&(e.g=settings),Object.keys(e).length&&GSKGenFuncs.isValidFileName(this.sFName.trim())&&(GSKGenFuncs.download(this.sFName.trim()+".umk",uyamak.cmprs.compressJSON(e),"application/uyamak;charset=utf-8"),this.showGUI(!1))},isValidFileName:function(){const e=/^[^\\/:\*\?"<>\|]+$/,t=/^\./,n=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return e.test(fname)&&!t.test(fname)&&!n.test(fname)},obtnAvail:function(e){let t=uyamak.cmprs.decompressJSON(e);this.oAvail.m=t.m,this.oAvail.v=t.v,this.oAvail.s=t.s,this.oAvail.g=t.g},selectFile:function(){this.fInput.click()},dragOperation:function(e){this.dDAtn=e.type,"dragenter"===this.dDAtn||"dragover"===this.dDAtn?(document.getElementById("drop-area").style.display="block",kbshort.suspend(!0,function(e){27===e.keyCode&&(document.getElementById("drop-area").style.display="none",kbshort.suspend(!1))})):document.getElementById("drop-area").style.display="none",GSKGenFuncs.preventDefaults(e),"drop"===this.dDAtn&&(this.oFileInfo=e.dataTransfer.files[0],this.showGUI(!0))},showGUI:function(e=!0){this.display=e,this.sFName||(this.sFName=GUIText[settings.lang].myUmkModel)}}});const uyamakFileManager={fileName:null,xmlText:function(e=mainSystem.graph){let t=new mxCodec;return mxUtils.getXml(t.encode(e.getModel()))},newModel:function(){confirm(GUIText[settings.lang].confirmLoss)&&mainSystem.graph.getModel().clear()},download:function(e,t){let n=document.createElement("a"),a=new Blob([t],{type:"application/uyamak;charset=utf-8"}),s=window.URL.createObjectURL(a);n.style.display="none",n.href=s,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)},saveLocal:function(e=!1){if(this.fileName=prompt(GUIText[settings.lang].enterFileName,GUIText[settings.lang].myUmkModel),this.fileName){let t={v:varManagerVue.variables};e||(t.s=simVue.simSettings,t.m=this.xmlText()),
this.download(this.fileName+".umk",this.compressJSON(t))}},importFlag:!1,openLocal:function(e=!1){this.importFlag=e,(e||confirm(GUIText[settings.lang].confirmLoss))&&this.fileInp.click()},fileInp:null,encoder:new mxCodec,compressJSON:function(e){let t=this.deflated16bit(JSON.stringify2(e));return t=this.escZero(t),this.ab2str(t)},decompressJSON:function(e){let t=new Uint16Array(this.str2ab(e));t=this.escZero(t,!1);let n=pako.inflate(t),a=this.ab2str(n);return JSON.parse2(a)},compressModel:function(e){let t=e.getModel(),n=this.encoder.encode(t),a=mxUtils.getXml(n),s=this.deflated16bit(a);return s=this.escZero(s),this.ab2str(s)},decompressModel:function(e){let t=new Uint16Array(this.str2ab(e));t=this.escZero(t,!1);let n=pako.inflate(t),a=this.ab2str(n),s=mxUtils.parseXml(a);return this.encoder.decode(s.documentElement)},deflated16bit:function(e){let t=pako.deflate(e);return new Uint16Array(t)},escZero:function(e,t=!0){return e.map(e=>e+(t?3077:-3077))},ab2str:function(e){return String.fromCharCode.apply(null,new Uint16Array(e))},str2ab:function(e){let t=new ArrayBuffer(2*e.length),n=new Uint16Array(t);for(let t=0,a=e.length;t<a;t++)n[t]=e.charCodeAt(t);return t}};uyamakFileManager.fileInp=document.createElement("input"),uyamakFileManager.fileInp.type="file",uyamakFileManager.fileInp.onchange=(e=>{let t=e.target.files[0],n=new FileReader;n.onload=function(e){try{uyamakFileManager.importFlag?(uyamakCbManager.prepareAltAndCopy(e.target.result),uyamakCbManager.bringModelToMain()):uyamakCbManager.inmportToGraph(e.target.result,mainSystem.graph)}catch(e){new Noty({text:GUIText[settings.lang].errorGen,timeout:5e3,theme:"nest",type:"error"}).show()}},n.readAsText(t),uyamakFileManager.fileInp.value=""});const simVue=new Vue({el:"#sim-menu",data:{mode:"mDesign",disp:{run:!0,stop:!1,pause:!1,forward:!0},simSettings:{h:10,T:5,realtime:!0,steps:1,sOEvery:1,mHis:1e3,it:"fe"},results:[],cellsWithSInfo:[],simWorker:null,exeOrder:[],updScreen:null,dispCells:[],dispExecOrdInProg:!1},watch:{simSettings:{deep:!0,handler:function(){this.simSettings.T||(this.simSettings.T=5),this.simSettings.h<0?this.simSettings.h=-this.simSettings.h:this.simSettings.h||(this.simSettings.h=100),this.simSettings.steps<0?this.simSettings.steps=-this.simSettings.steps:this.simSettings.steps||(this.simSettings.steps=1),this.simSettings.steps===Math.round(this.simSettings.steps)&&(this.simSettings.steps=Math.round(this.simSettings.steps)),this.simSettings.sOEvery<0?this.simSettings.sOEvery=-this.simSettings.sOEvery:this.simSettings.sOEvery||(this.simSettings.sOEvery=2),this.simSettings.sOEvery===Math.round(this.simSettings.sOEvery)&&(this.simSettings.sOEvery=Math.round(this.simSettings.sOEvery)),this.simSettings.mHis<0?this.simSettings.mHis=-this.simSettings.mHis:this.simSettings.mHis||(this.simSettings.mHis=100),this.simSettings.mHis===Math.round(this.simSettings.mHis)&&(this.simSettings.mHis=Math.round(this.simSettings.mHis)),footerVue.$set(footerVue.$data,"totalTime",this.simSettings.T),this.simWorker&&this.informSim("simSettings")}},mode:function(){switch(footerVue.$set(footerVue.$data,"mode",this.mode),this.mode){case"mDesign":this.disp={run:!0,stop:!1,pause:!1,forward:!0},editorVue.rpSettings.fEditMode=!0;break;case"mSim":this.disp={run:!1,stop:!0,pause:!0,forward:!1},editorVue.rpSettings.fEditMode=!1;break;case"mSimPause":this.disp={run:!0,stop:!0,pause:!1,forward:!0},editorVue.rpSettings.fEditMode=!1}}},methods:{resStr2Math:function(){for(let e=0;e<this.results.length;e++){let t=Object.keys(this.results[e].o);for(let n=0;n<t.length;n++)if(this.dispCells)try{this.results[e].o[t[n]]=math.evaluate(this.results[e].o[t[n]])}catch(a){console.log(t),console.log(e),console.log(n),console.log(this.results[e].o[t[n]]),console.log(a)}}},updateSources:function(e){for(let t=0;t<e.length;t++){let n=this.getSourcesWithIndexes(mainSystem.graph.getModel().cells[e[t].cid]),a=[];for(let t=0;t<n.length;t++)a.push({cell:e.findIndex(function(e){return n[t].model.id===e.cid}),index:n[t].index});e[t].sIndexes=a}return e},pCell4Exp:function(inCell){try{let cellVal=JSON.parse2(JSON.stringify2(inCell.value));if(cellVal.cid=inCell.id,eval("var tempModel = new "+cellVal.id+"(cellVal)"),cellVal=tempModel,cellVal.Parameters){let e=Object.keys(cellVal.Parameters);for(let t=0;t<e.length;t++)"Complex"!==cellVal.Parameters[e[t]].Type&&"Real"!==cellVal.Parameters[e[t]].Type&&"Integer"!==cellVal.Parameters[e[t]].Type||(cellVal.Parameters[e[t]].Value=varManagerVue.getVarValue(cellVal.Parameters[e[t]].Value))}if(cellVal.genCompParams(),cellVal.Parameters){let e=Object.keys(cellVal.Parameters);for(let t=0;t<e.length;t++)"Complex"!==cellVal.Parameters[e[t]].Type&&"Real"!==cellVal.Parameters[e[t]].Type&&"Integer"!==cellVal.Parameters[e[t]].Type||(cellVal.Parameters[e[t]].Value=cellVal.Parameters[e[t]].Value.toString())}if(cellVal.CompParams){let e=Object.keys(cellVal.CompParams);for(let t=0;t<e.length;t++)cellVal.CompParams[e[t]]=cellVal.CompParams[e[t]].toString()}return cellVal.showInpOnHtml&&this.dispCells.push(cellVal.cid),cellVal}catch(e){throw console.log(e),{cell:inCell,errM:String(e)}}},informSim:function(e,t){try{if(window.Worker){let n={};switch(e){case"cells":try{this.dispCells=[];let e=this.exeOrder.map(e=>{let t=this.pCell4Exp(e);return t.isPopup&&popup.sendParams(t),t});this.cellsWithSInfo=this.updateSources(e),n={cells:this.cellsWithSInfo}}catch(e){throw console.log(e),n={},e}break;case"updateCell":try{let e=this.exeOrder.findIndex(function(e){return t===e.id});if(e>=0){let t=this.pCell4Exp(this.exeOrder[e]);t.isPopup&&popup.sendParams(t),t.sIndexes=this.cellsWithSInfo[e].sIndexes,n={updateCell:{v:t,i:e}}}}catch(e){throw console.log(e),n={},e}break;case"simSettings":n={simSettings:this.simSettings};break;case"start":this.simWorker||this.initSim(),n={start:0},this.mode="mSim";break;case"stop":this.simWorker&&(n={stop:0}),this.endSim();break;case"pause":this.simWorker&&(n={pause:0});break;case"steps":this.simWorker||this.initSim(),n={steps:0}}Object.keys(n).length&&this.simWorker&&this.simWorker.postMessage(n)}else new Noty({text:GUIText[settings.lang].k169,timeout:5e3,theme:"nest",type:"warning"}).show()}catch(e){throw e.cell&&(mainSystem.graph.setCellWarning(e.cell,e.errM),console.log(e.errM)),console.log(e),e}},propOuts:function(){this.setAllDisplays();for(let e=0;e<Object.keys(popup.rCells).length;e++)setTimeout(popup.sendData(Object.keys(popup.rCells)[e]))},setAllDisplays:function(){let e=this.results[this.results.length-1];footerVue.presTime=e.t;for(let t=0;t<this.dispCells.length;t++){let n=mainSystem.graph.getModel().getCell(this.dispCells[t]);n.value.Icon(TeX.prepDisp(TeX.frmStr(e.o[this.dispCells[t]]))),mainSystem.graph.refresh(n)}},initSim:function(){if(window.Worker){if(this.exeOrder=this.getExecutionOrder().eo,!(this.exeOrder.length>0))throw new Noty({text:GUIText[settings.lang].k170,timeout:5e3,theme:"nest",type:"warning"}).show(),"Nothing to execute";varManagerVue.checkAllCellsParams()?(this.simWorker||(this.simWorker=new Worker("simulator.min.js?date="+Date.now())),this.simWorker.onmessage=function(e){e.data.put?(simVue.results=e.data.put,simVue.results=simVue.results.slice(-simVue.simSettings.mHis),setTimeout(function(){simVue.propOuts()})):e.data.ended?simVue.endSim():e.data.paused?simVue.mode="mSimPause":e.data.error&&mainSystem.graph.setCellWarning(mainSystem.graph.getModel().getCell(e.data.error.cid),"<b>"+GUIText[settings.lang][e.data.error.desc]+"</b>\n"+e.data.error.log.message)},this.results=[],popup.resetAll(),footerVue.presTime=0,this.informSim("cells"),this.informSim("simSettings")):new Noty({text:GUIText[settings.lang].k173,timeout:5e3,theme:"nest",type:"warning"}).show()}else new Noty({text:GUIText[settings.lang].k169,timeout:5e3,theme:"nest",type:"warning"}).show()},endSim:function(){this.simWorker&&this.simWorker.terminate(),this.simWorker=null,this.mode="mDesign"},displayExecutionOrder:function(){this.dispExecOrdInProg||(this.dispExecOrdInProg=!0,setTimeout(()=>{simVue.dispExecOrdNow()},200))},dispExecOrdNow:function(){this.dispExecOrdInProg=!1;let e=this.getAllTheModels();this.showExecutionOrderMessage(e,"<span class='fa-stack eo_icon'><i class='fas fa-ban fa-stack-2x'></i><i class='fas fa-project-diagram fa-stack-1x'></i></span>");let t=this.getExecutionOrder(),n=t.eo;for(let e=0;e<n.length;e++)this.showExecutionOrderMessage([n[e]],"&#x2713;&nbsp;"+(e+1));this.showExecutionOrderMessage(t.al,"&times;:&nbsp;&#x21ab;",GUIText[settings.lang].aLoop),this.showExecutionOrderMessage(t.ne,"<i class='fas fa-times'></i>"),this.showExecutionOrderMessage(t.pc,"<span class='fa-stack eo_icon'><i class='fas fa-ban fa-stack-2x'></i><i class='fas fa-plug fa-stack-1x'></i></span>"),mainSystem.refresh()},getExecutionOrder:function(){let e=[],t=this.getAllConnectedModels(),n=t.fc,a=[];for(let t=0;t<n.length;t++)(0===n[t].value.TerminalsIn.max||n[t].value.fInEO)&&e.push(n[t]);for(let t=0;t<e.length;t++)n=this.arrayRemove(n,e[t]);let s=e.slice(),r=0;try{for(;n.length>0;){let e=this.getSourcesWithIndexes(n[r]),t=!0;for(let n=0;n<e.length;n++)s.indexOf(e[n].model)<0&&(t=!1);if(t?(s.push(n[r]),n=this.arrayRemove(n,n[r]),r=0):r++,n.length>0&&r>=n.length){for(let e=0;e<s.length;e++){let t=this.getTargetsOfAModel(s[e]);for(let e=0;e<t.length;e++)n.indexOf(t[e])>=0&&(a.push(t[e]),n=this.arrayRemove(n,t[e]))}throw a.length>0?{code:"UMKEOAL",message:"arthematic loop(s) found"}:{code:"UMKEOIC",message:"Incomplete/improper connections detected"}}}}catch(e){console.log(e)}return{eo:s,ne:n,al:a,pc:t.pc}},getSourcesWithIndexes:function(e){let t=[];for(let n=0;n<e.children.length;n++)if(e.children[n].style.search("umk_input")>=0){let a={model:model=null,index:index=null},s=mainSystem.graph.getNodeCells(e.children[n]);for(let e=0;e<s.length;e++)if(s[e].style&&s[e].style.search("umk_output")>=0){a.model=s[e].parent;let t=-1;for(let n=0;n<s[e].parent.children.length;n++)if(s[e].parent.children[n].style&&s[e].parent.children[n].style.search("umk_output")>=0&&(t++,s[e]===s[e].parent.children[n])){a.index=t;break}break}t.push(a)}return t},getSourcesOfAModel:function(e){let t=[];for(let n=0;n<e.children.length;n++)if(e.children[n].style.search("umk_input")>=0)try{t.indexOf(e.children[n].edges[0].source.parent)<0&&t.push(e.children[n].edges[0].source.parent)}catch(e){}return t},getTargetsOfAModel:function(e){let t=[];for(let n=0;n<e.children.length;n++)if(e.children[n].style.search("umk_output")>=0)for(let a=0;a<e.children[n].edges.length;a++)try{t.indexOf(e.children[n].edges[a].target.parent)<0&&t.push(e.children[n].edges[a].target.parent)}catch(e){}return t},getAllTheModels:function(){let e=[];mainSystem.graph.getDefaultParent().children&&(e=e.concat(mainSystem.graph.getDefaultParent().children));for(let t=0;t<e.length;t++)e[t].children&&(e=e.concat(e[t].children));let t=[];for(let n=0;n<e.length;n++)e[n].isVertex()&&"object"==typeof e[n].value&&t.push(e[n]);return t},getAllConnectedModels:function(){let e=[];mainSystem.graph.getDefaultParent().children&&(e=e.concat(mainSystem.graph.getDefaultParent().children));for(let t=0;t<e.length;t++)e[t].children&&(e=e.concat(e[t].children));let t=[];for(let n=0;n<e.length;n++)e[n].isVertex()&&e[n].style&&(e[n].style.search("umk_input")>=0||e[n].style.search("umk_output")>=0)&&e[n].edges&&e[n].edges.length>0&&t.indexOf(e[n].parent)<0&&t.push(e[n].parent);let n=[],a=[];for(let e=0;e<t.length;e++){let s=!0;for(let n=0;n<t[e].children.length;n++)(t[e].children[n].style.search("umk_input")>=0||t[e].children[n].style.search("umk_input")>=0)&&(!t[e].children[n].edges||t[e].children[n].edges.length<1)&&(s=!1);s?n.push(t[e]):a.push(t[e])}return{ac:t,fc:n,pc:a}},showExecutionOrderMessage:function(e,t,n){for(let n=0;n<e.length;n++)for(let a=0;a<e[n].children.length;a++)e[n].children[a].style.search("umk_EO")>=0&&e[n].children[a].setValue(t)},arrayRemove:function(e,t){return e.filter(function(e){return e!=t})}}}),popup={rCells:{},rType:{},open:function(e,t){let n=document.getElementById("graph"),a=e.pageX-n.offsetLeft,s=e.pageY-n.offsetTop,r=mainSystem.graph.getCellAt(a,s);if(r.style.search("umk_model")>=0){let e={};e.v=Object.assign({cid:r.id},r.value),e.lang="chart"===t?GUIText[settings.lang].chartLang:settings.lang;let n=packer.pack(JSON.stringify2(e));switch(t){case"chart":this.rType[r.id]="chart",this.openUrl(r.id,"chart.html?"+n,"width=600,height=300,")}}},openUrl:function(e,t,n){this.rCells[e]&&!this.rCells[e].closed?this.rCells[e].focus():this.rCells[e]=window.open(t,"_blank",n)},closeAll:function(e=!1){let t=Object.keys(this.rCells);for(let e=0;e<t.length;e++)this.rCells[t[e]].close();e&&(this.rCells=[],this.rType=[])},close:function(e){this.rCells&&this.rCells[e]&&this.rCells[e].close()},prepareData:function(e){try{return function(t){let n=math.evaluate(t.o[e]);return{t:t.t,v:[math.re(n)._data,math.im(n)._data]}}}catch(e){console.log(e)}},sendParams:function(e){this.rCells[e.cid]&&!this.rCells[e.cid].closed&&this.rCells[e.cid].postMessage({c:e})},sendData:function(e){this.rCells[e]&&!this.rCells[e].closed&&this.rCells[e].postMessage({d:simVue.results.map(popup.prepareData(e))})},resetAll:function(){let e=Object.keys(this.rCells);for(let t=0;t<e.length;t++)this.rCells[e[t]]&&!this.rCells[e[t]].closed&&this.rCells[e[t]].postMessage({r:!0})}};uyamak.cmprs={encoder:new mxCodec,xmlText:function(e=mainSystem.graph){return mxUtils.getXml(this.encoder.encode(e.getModel()))},compressJSON:function(e){return packer.pack(JSON.stringify2(e))},decompressJSON:function(e){return JSON.parse2(packer.unpack(e))},compressModel:function(e=mainSystem.graph){e||(e=mainSystem.graph);let t=e.getModel(),n=this.encoder.encode(t),a=mxUtils.getXml(n);return packer.pack(a)},decompressModel:function(e){let t=packer.unpack(e),n=mxUtils.parseXml(t);return this.encoder.decode(n.documentElement)}},(()=>{try{const e=["gLinesMinor","gLinesMajor","gLinesMega","showOutline","gridSize","guidesEnabled","showLabels","showExeOrder","snapToGrid"],t=getCookie("settings")?JSON.parse2(getCookie("settings")):Object.assign({},settings);Object.keys(t).forEach(function(n){settings[n]&&(settings[n]=t[n]),e.indexOf(n)>=0&&editorVue.$set(editorVue.$data.rpSettings,n,t[n])}),settingsVue.updateHideBtnText()}catch(e){console.log(e)}})(),suspendUserInterface.suspendInterface(),kbshort.suspend(!1);var searchBox=document.querySelectorAll('.search-box input[type="text"] + span');searchBox.forEach(e=>{e.addEventListener("click",()=>{e.previousElementSibling.value=""})}),window.onbeforeunload=function(){simVue.informSim("stop"),simVue.dbName=null,popup.closeAll()},window.addEventListener("message",function(e){console.log(e)},!0),["dragenter","dragover","drop","dragexit"].forEach(e=>{document.getElementsByTagName("BODY")[0].addEventListener(e,uyamak.lFManagerVue.dragOperation,!1)}),document.getElementsByTagName("BODY")[0].addEventListener("dragleave",GSKGenFuncs.preventDefaults,!1),["dragenter","dragover","dragleave","drop"].forEach(e=>{document.addEventListener(e,GSKGenFuncs.preventDefaults,!1)});